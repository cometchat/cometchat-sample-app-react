export default cometchat=function(e){var t={};function n(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(s,r,function(t){return e[t]}.bind(null,r));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=24)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(5);t.constants={DEFAULT_STORE:"cometchat",MSG_VER_PRE:"store-ver-pre",MSG_VER_POST:"store-ver-post"},function(e){e.Public="public",e.Private="private",e.Protected="protected"}(t.GroupType||(t.GroupType={})),function(e){e.Admin="admin",e.Moderator="moderator",e.Member="member"}(t.GroupMemberScope||(t.GroupMemberScope={})),t.XMPP={host:"encke.cometchat.com",port:7070,bind_url:"/http-bind",deafult_password:"CometChat",jid_string:"[%s]%s@%s/%s",bare_jid_string:"[%s]%s@%s",username_string:"[%s]%s",muc_jid_string:"[%s]%s@%s.%s",xmpp_resource:"cometchat_js_sdk"+(new Date).getTime()},t.LOCAL_STORE={COMMON_STORE:"common_store",USERS_STORE:"users_store",MESSAGES_STORE:"messages_store",STORE_STRING:"%s:%s"},t.ResponseConstants={RESPONSE_KEYS:{KEY_DATA:"data",KEY_ACTION:"action",KEY_MESSAGE:"message",KEY_ERROR:"error",KEY_ERROR_DETAILS:"details",KEY_ERROR_CODE:"code",KEY_ERROR_MESSAGE:"message",KEY_AUTH_TOKEN:"authToken",KEY_WS_CHANNEL:"wsChannel",KEY_IDENTITY:"identity",KEY_SERVICE:"identity",KEY_ENTITIES:"entities",KEY_ENTITITY:"entity",CODE_REQUEST_OK:200,CODE_BAD_REQUEST:401}},t.MessageConstatnts={TYPE:{TEXT:"text",MEDIA:"media",IMAGE:"image",VIDEO:"video",AUDIO:"audio",FILE:"file"},CATEGORY:{MESSAGE:"message",ACTION:"action",CALL:"call"},RECEIVER_TYPE:{USER:"user",GROUP:"group"},KEYS:{ACTION:"action",TYPE:"type",DATA:"data",ID:"id",MUID:"muid",SENDER:"sender",RECEIVER:"receiver",CATEGORY:"category",RECEIVER_TYPE:"receiverType",SENT_AT:"sentAt",STATUS:"status",TEXT:"text",URL:"url"},PAGINATION:{AFFIX:{APPEND:"append",PREPEND:"prepend"},CURSOR_FILEDS:{ID:"id",SEND_AT:"sentAt"},CURSOR_AFFIX_DEFAULT:"prepend",CURSOR_FIELD_DEFAULT:"sentAt",KEYS:{PER_PAGE:"per_page",CURSOR_AFFIX:"cursorAffix",CURSOR_FIELD:"cursorField",CURSOR_VALUE:"cursorValue"}}},function(e){e.ACTION="action",e.MESSAGE="message",e.CALL="call"}(t.MessageCategory||(t.MessageCategory={})),t.ActionConstatnts={ACTION_SUBJECTS:{ACTION_ON:"on",ACTION_BY:"by",ACTION_FOR:"for"},ACTION_ENTITY_TYPE:{GROUP_USER:"groupuser",USER:"user",GROUP:"group"},ACTION_KEYS:{ACTION_CREATED:"created",ACTION_UPDATED:"updated",ACTION_DELETED:"deleted",ENTITY:"entity",ENTITY_TYPE:"entityType",TYPE_MEMBER_JOINED:"joined",TYPE_MEMBER_LEFT:"left",TYPE_MEMBER_KICKED:"kicked",TYPE_MEMBER_OUTCASTED:"outcasted",TYPE_MEMBER_REINSTATED:"reinstated",TYPE_MEMBER_INVITED:"invited",ACTION_SCOPE_CHANGED:"scopeChanged",ACTION_TYPE_USER:"user",ACTION_TYPE_GROUP:"group",ACTION_TYPE_GROUP_MEMBER:"groupMember",ACTION_TYPE_CALL:"call"},ActionMessages:{ACTION_GROUP_JOINED_MESSAGE:"%s joined %s",ACTION_GROUP_LEFT_MESSAGE:"%s left %s",ACTION_MEMBER_KICKED_MESSAGE:"%s kicked %s from %s",ACTION_MEMBER_OUTCASTED_MESSAGE:"%s outcasted %s from %s",ACTION_MEMBER_REINSTATED_MESSAGE:"%s outcasted %s from %s",ACTION_MEMBER_INVITED_MESSAGE:"%s outcasted %s from %s"},ACTION_TYPE:{TYPE_MEMBER_JOINED:"joined",TYPE_MEMBER_LEFT:"left",TYPE_MEMBER_KICKED:"kicked",TYPE_MEMBER_OUTCASTED:"outcasted",TYPE_MEMBER_REINSTATED:"reinstated",TYPE_MEMBER_INVITED:"invited",TYPE_MEMBER_SCOPE_CHANGED:"scopeChanged"}},t.CallConstants={CALL_TYPE_AUDIO:"audio",CALL_TYPE_VIDEO:"video",CALL_KEYS:{CALL_DATA:"data",CALL_ID:"id",CALL_SESSION_ID:"sessionid",CALL_RECEIVER:"receiver",CALL_SENDER:"sender",CALL_RECEIVER_TYPE:"receiverType",CALL_STATUS:"status",CALL_TYPE:"type",CALL_INITIATED_AT:"initiatedAt",CALL_METADATA:"metadata",CALL_ENTITIES:"entities",CALL_ENTITY_TYPE:"entityType",CALL_ENTITY:"entity",CALL_ENTITY_USER:"user",CALL_ENTITY_GROUP:"group"},CALL_STATUS:{CALL_STATUS_INITIATED:"initiated",CALL_STATUS_ONGOING:"ongoing",CALL_STATUS_UNANSWERED:"unanswered",CALL_STATUS_REJECTED:"rejected",CALL_STATUS_BUSY:"busy",CALL_STATUS_CANCELLED:"cancelled",CALL_STATUS_ENDED:"ended"}},t.GroupConstants={KEYS:{NAME:"name",GUID:"guid",TYPE:"type",PASSWORD:"password",ICON:"icon",DESCRIPTION:"description",OWNER:"owner",METADATA:"metadata",CREATED_AT:"createdAt",UPDATED_AT:"updatedAt",HAS_JOINED:"hasJoined",WS_CHANNEL:"wsChannel"}},t.GroupMemersConstans={UID:"uid",GUID:"guid",USER:"user"},t.UserConstants={UID:"uid",NAME:"name",AUTH_TOKEN:"authToken",AVATAR:"avatar",CREDITS:"credits",EMAIL:"email",LAST_ACTIVE_AT:"lastActiveAt",LINK:"link",META_DATA:"metaData",ROLE:"role",STATUS:"status",STATUS_MESSAGE:"statusMessage",USER_NAME:"user_name"},t.Errors={ERROR_IO_EXCEPTION:"ERROR_IO_EXCEPTION",ERROR_JSON_EXCEPTION:"ERROR_JSON_EXCEPTION",ERROR_PASSWORD_MISSING:"ERROR_PASSWORD_MISSING",ERROR_LIMIT_EXCEEDED:"ERROR_LIMIT_EXCEEDED",ERROR_USER_NOT_LOGGED_IN:"ERROR_USER_NOT_LOGGED_IN",ERROR_INVALID_GUID:"ERROR_INVALID_GUID",ERROR_PASSWORD_MISSING_MESSAGE:"Password is mandatory for a protected group",ERROR_LIMIT_EXCEEDED_MESSAGE:"Limit Exceeded Max limit of %s",ERROR_USER_NOT_LOGGED_IN_MESSAGE:"Please log in to CometChat before calling this method",ERROR_INVALID_GUID_MESSAGE:"Please provide a valid GUID",ERROR_DEFAULT_MESSAGE:"Something went wrong"},t.GroupErrors={NOT_A_GROUP:new s.CustomError({code:"NOT_A_GROUP",message:"Please use group class to construct a new group"})},t.PresenceConstatnts={XMPP_KEYS:{FROM:"from",STATUS:"status",LAST_ACTIVE_AT:"lastActiveAt",TYPE:"type"},STATUS:{ONLINE:"online",OFFLINE:"offline"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isObject=function(e){return e instanceof Object&&e.constructor===Object},t.isTruthy=function(e){return[!0,1,"1","true","TRUE"].includes(e)},t.isFalsy=function(e){return"string"==typeof e&&(e=e.trim()),"object"==typeof e&&0===Object.keys(e).length&&(e=void 0),["",0,"0",!1,null,"null",void 0,"undefined"].includes(e)},t.getOrdinalSuffix=function(e){let t=e%10,n=e%100;return 1==t&&11!=n?e+"st":2==t&&12!=n?e+"nd":3==t&&13!=n?e+"rd":e+"th"},t.format=function(e,...t){return e.split("%s").reduce((e,n,s)=>e+n+(t[s]||""),"")},t.createUidFromJid=function(e){return e.substring(e.lastIndexOf("]")+1,e.lastIndexOf("@"))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(19),r=n(1),o=n(5),i=n(4),a=n(3),c=n(6),u=n(7),l=n(18),h=n(15),d=n(14),p=n(13),f=n(10),m=n(21),_=n(0),g=n(11),S=n(22),E=n(23),A=n(12),C=n(34);let T=c.XMPPConnectionHelper.getInstance();class v{constructor(e){v.appId=e,this.messagesStore=f.MessagesStore.getInstance(),this.localStorage=l.LocalStorage.getInstance(),this.userStore=E.UserStore.getInstance()}static getInstance(e){return this.cometChat||(this.cometChat=new v(e)),this.cometChat}login(...e){return new Promise((t,n)=>this.localStorage.get("user").then(s=>{if(2!=e.length)return v.authToken=e[0],v.isSecure=!0,this.getMyInfo().then(s=>{console.log("user",s),this.user=new a.Me(s),console.log("me",this.user),this.user.$authToken=e[0],this.setAuthToken(e[0]),this.XMPPLogin(this.user,t,n)},e=>{n(e.error)});{v.isSecure=!1,v.apiKey=e[1];let i=e[0];null!=s&&s.$uid!==e[0]?(this.user=new a.Me(s),this.setAuthToken(this.user.$authToken),this.XMPPLogin(this.user,t,n)):r.isFalsy(v.authToken)?r.isFalsy(i)||(r.isFalsy(v.apiKey)?n(new o.CustomError({code:"-1",name:"UnAuthorised",message:"No uid provided"})):this.generateAuthToken(i).then(e=>{this.user=new a.Me(e),this.setAuthToken(this.user.$authToken),this.getMyInfo().then(e=>{this.user=new a.Me(e),this.user.$authToken=v.authToken,this.setAuthToken(this.user.$authToken),this.XMPPLogin(this.user,t,n)},e=>{n(e)})},e=>{n({status:-1,name:e.error.code,message:"User not present"})})):this.XMPPLogin(this.user,t,n)}}))}setAuthToken(e){v.authToken=e}generateAuthToken(e){return new Promise((t,n)=>{i.makeApiCall("authToken",{uid:e}).then(e=>{t(e.data)}).catch(e=>{n(e)})})}getMyInfo(){return new Promise((e,t)=>{i.makeApiCall("getMyDetails").then(t=>{e(t.data)}).catch(e=>{console.log(e),t(e)})})}getUsers(){return i.makeApiCall("users")}sendMessage(e){return new Promise((t,n)=>{if(e instanceof d.TextMessage||e instanceof h.MediaMessage)return i.makeApiCall("sendMessage",{},e,e instanceof h.MediaMessage).then(e=>{this.messagesStore.storeMessages([p.MessageController.trasformJSONMessge(e.data)]),t(p.MessageController.trasformJSONMessge(e.data))},e=>{n(e)});n(new o.CustomError({code:"",name:"NOT A MESSAGE"}))})}sendMediaMessage(e){return new Promise((t,n)=>{if(r.isFalsy(e))n(new o.CustomError({message:"not a media message"}));else{if(e instanceof h.MediaMessage)return i.makeApiCall("sendMessage",{},e,!0).then(e=>{this.messagesStore.storeMessages([p.MessageController.trasformJSONMessge(e.data)]),t(p.MessageController.trasformJSONMessge(e.data))},e=>{n(e)});n(new o.CustomError({message:"not a media message"}))}})}getMessages(){let e=[];return i.makeApiCall("getMessages",{},{per_page:10}).then(t=>(t.data.map(t=>{e.push(p.MessageController.trasformJSONMessge(t))}),this.messagesStore.storeMessages(e)))}XMPPLogin(e,t,n){T.XMMPLogin(e.getUid(),e.getWsChannel().secret,s=>{switch(s){case u.Strophe.Status.CONNFAIL:n({status:-1,name:"XMPP_CONNECTION_FAIL",message:"XMPP username/password not correct"});break;case u.Strophe.Status.CONNECTED:this.localStorage.set("user",e),this.messagesStore.get(_.constants.MSG_VER_POST).then(e=>{null==e&&(e=0),p.MessageController.getOfflineHistory(1e3,e)}),t(new a.AppUser(e));break;case u.Strophe.Status.AUTHFAIL:n({status:-1,name:"XMPP_CONNECTION_FAIL",message:"XMPP username/password not correct"})}})}getUser(e){return new Promise((t,n)=>{i.makeApiCall("user",{uid:e}).then(e=>{let n=m.UsersController.trasformJSONUser(e.data),s=[];s.push(r.format(_.XMPP.username_string,v.getAppId(),e.data[_.UserConstants.UID])),c.XMPPConnectionHelper.getInstance().getPresenceInfo(s,e=>{s.map((s,r)=>{n.setLastActiveAt(e[r].getLastActiveAt()),n.setStatus(e[r].getStatus()),t(n)})})}).catch(e=>{n(new o.CustomError(e.error))})})}createGroup(e){return new Promise((t,n)=>{e instanceof g.Group||n(_.GroupErrors.NOT_A_GROUP),i.makeApiCall("createGroup",{},e).then(n=>{T.joinMuc(e),t(S.GroupsController.trasformJSONGroup(n.data))},e=>{n(new o.CustomError(e.error))})})}getGroup(e){return new Promise((t,n)=>{i.makeApiCall("getGroup",{guid:e}).then(e=>{t(S.GroupsController.trasformJSONGroup(e.data))},e=>{n(new o.CustomError(e.error))})})}joinGroup(e,t,n){return new Promise((s,a)=>{let c;c=r.isFalsy(n)?new g.Group(e,"name",t):new g.Group(e,"",t,n),i.makeApiCall("joinGroup",c,c).then(e=>{T.joinMuc(c),s(S.GroupsController.trasformJSONGroup(e.data[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA][_.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][_.ActionConstatnts.ACTION_KEYS.ENTITY]))},e=>{a(new o.CustomError(e.error))})})}updateGroup(e){return new Promise((t,n)=>{e instanceof g.Group||n(new o.CustomError({message:"No such Group present"})),i.makeApiCall("updateGroup",e,e).then(e=>{t(S.GroupsController.trasformJSONGroup(e.data))},e=>{n(new o.CustomError(e.error))})})}deleteGroup(e){return new Promise((t,n)=>{i.makeApiCall("deleteGroup",{guid:e}).then(e=>{t(S.GroupsController.trasformJSONGroup(e.data))},e=>{n(new o.CustomError(e.error))})})}leaveGroup(e){return new Promise((t,n)=>{i.makeApiCall("leaveGroup",{guid:e}).then(n=>{T.leaveMuc(e),t(!0)},e=>{n(new o.CustomError(e.error))})})}kickGroupMembers(e,t){return new Promise((n,s)=>{i.makeApiCall("kickGroupMembers",{guid:e,uid:t}).then(e=>{n(!0)},e=>{s(new o.CustomError(e.error))})})}changeScopeOfMember(e,t,n){return new Promise((s,r)=>{i.makeApiCall("changeScopeOfMember",{guid:e,uid:t},{scope:n}).then(e=>{s(!0)},e=>{r(new o.CustomError(e.error))})})}banGroupMember(e,t,n){return new Promise((n,s)=>{i.makeApiCall("banGroupMember",{guid:e,uid:t}).then(e=>{n(!0)},e=>{s(new o.CustomError(e.error))})})}unbanGroupMember(e,t){return new Promise((n,s)=>{i.makeApiCall("unbanGroupMember",{guid:e,uid:t}).then(e=>{n(!0)},e=>{s(new o.CustomError(e.error))})})}initiateCall(e){return new Promise((t,n)=>{i.makeApiCall("createCallSession",{},e).then(e=>{let n=A.Call.callFromJSON(e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);C.CallController.getInstance(n,"",n.getSessionId()).initiateCall(),t(Object.assign(n,e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]))},e=>{n(new o.CustomError(e.error))})})}joinCall(e){return new Promise((t,n)=>{let s={};s[_.CallConstants.CALL_KEYS.CALL_STATUS]=_.CallConstants.CALL_STATUS.CALL_STATUS_ONGOING,i.makeApiCall("updateCallSession",{sessionid:e},s).then(e=>{let n=A.Call.callFromJSON(e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);t(Object.assign(n,e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]))},e=>{n(new o.CustomError(e.error))})})}rejectCall(e){return new Promise((t,n)=>{let s={};s[_.CallConstants.CALL_KEYS.CALL_STATUS]=_.CallConstants.CALL_STATUS.CALL_STATUS_REJECTED,i.makeApiCall("updateCallSession",{sessionid:e},s).then(e=>{let n=A.Call.callFromJSON(e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);t(Object.assign(n,e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]))},e=>{n(new o.CustomError(e.error))})})}cancelCall(e){return new Promise((t,n)=>{let s={};s[_.CallConstants.CALL_KEYS.CALL_STATUS]=_.CallConstants.CALL_STATUS.CALL_STATUS_CANCELLED,i.makeApiCall("updateCallSession",{sessionid:e},s).then(e=>{let n=A.Call.callFromJSON(e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);t(Object.assign(n,e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]))},e=>{n(new o.CustomError(e.error))})})}sendBusyResponse(e){return new Promise((t,n)=>{let s={};s[_.CallConstants.CALL_KEYS.CALL_STATUS]=_.CallConstants.CALL_STATUS.CALL_STATUS_BUSY,i.makeApiCall("updateCallSession",{sessionid:e},s).then(e=>{let n=A.Call.callFromJSON(e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);t(Object.assign(n,e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]))},e=>{n(new o.CustomError(e.error))})})}endCall(e){return new Promise((t,n)=>{let s={};s[_.CallConstants.CALL_KEYS.CALL_STATUS]=_.CallConstants.CALL_STATUS.CALL_STATUS_ENDED,i.makeApiCall("updateCallSession",{sessionid:e},s).then(e=>{let n=A.Call.callFromJSON(e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);t(Object.assign(n,e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]))},e=>{n(new o.CustomError(e.error))})})}sendUnansweredResponse(e){return new Promise((t,n)=>{let s={};s[_.CallConstants.CALL_KEYS.CALL_STATUS]=_.CallConstants.CALL_STATUS.CALL_STATUS_UNANSWERED,i.makeApiCall("updateCallSession",{sessionid:e},s).then(e=>{let n=A.Call.callFromJSON(e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]);t(Object.assign(n,e[_.ResponseConstants.RESPONSE_KEYS.KEY_DATA]))},e=>{n(new o.CustomError(e.error))})})}startCall(e,t){let n=document.createElement("iframe");n.src="https://i.chatforyoursite.com/jitsi-meet/"+e,n.name="frame",n.setAttribute("allow","camera,microphone"),n.setAttribute("width","800"),n.setAttribute("height","800"),document.body.appendChild(n),window.addEventListener("message",e=>{"hangup"==e.data.type&&document.body.removeChild(n)})}addMessageEventListner(e,t,n){T.addMessageListner(e,t,n)}removeMessageEventListner(e){T.removeMessageListner(e)}addPresenceListner(e,t,n){T.addPresenceListner(e,t,n)}removePreseceListner(e){T.removeMessageListner(e)}static getAppId(){return v.appId}getApiKey(){return v.apiKey}getAuthToken(){return v.authToken}}v.endpointFactory=new s.EndpointFactory,t.CometChat=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{getUid(){return this.uid}setUid(e){this.uid=e}getName(){return this.name}setName(e){this.name=e}getAuthToken(){return this.authToken}setAuthToken(e){this.authToken=e}getAvatar(){return this.avatar}setAvatar(e){this.avatar=e}getCredits(){return this.credits}setCredits(e){this.credits=e}getEmail(){return this.email}setEmail(e){this.email=e}getLastActiveAt(){return this.lastActiveAt}setLastActiveAt(e){this.lastActiveAt=e}getLink(){return this.link}setLink(e){return this.link=e}getMetadata(){return this.metadata}setMetadata(e){this.metadata=e}getRole(){return this.role}setRole(e){this.role=e}getStatus(){return this.status}setStatus(e){this.status=e}getStatusMessage(){return this.statusMessage}setStatusMessage(e){this.statusMessage=e}get $uid(){return this.uid}get $name(){return this.name}get $authToken(){return this.authToken}get $avatar(){return this.avatar}get $credits(){return this.credits}get $email(){return this.email}get $lastActiveAt(){return this.lastActiveAt}get $link(){return this.link}get $metadata(){return this.metadata}get $role(){return this.role}get $statusMessage(){return this.statusMessage}set $uid(e){this.uid=e}set $name(e){this.name=e}set $authToken(e){this.authToken=e}set $avatar(e){this.avatar=e}set $credits(e){this.credits=e}set $email(e){this.email=e}set $lastActiveAt(e){this.lastActiveAt=e}set $link(e){this.link=e}set $metadata(e){this.metadata=e}set $role(e){this.role=e}set $statusMessage(e){this.statusMessage=e}constructor(e){this.uid=e.uid,this.name=e.name,this.authToken=e.authToken,this.avatar=e.avatar,this.credits=e.credits,this.email=e.email,this.lastActiveAt=e.lastActiveAt,this.link=e.link,this.metadata=e.metadata,this.role=e.role,this.status=e.status,this.statusMessage=e.statusMessage}}t.AppUser=s;t.Me=class extends s{constructor(e){super(e),this.wsChannel=e.wsChannel}getWsChannel(){return this.wsChannel}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(26),r=n(2),o=n(1),i=n(35);function a(e="",t="GET",n={},s={},r){var a;return o.isFalsy(n)?n=void 0:("GET"==t&&(e=e+"?"+i.stringify(n),n=void 0),r&&(a=new FormData(this),Object.keys(n).map(e=>{n[e]instanceof Object&&!(n[e]instanceof File)?a.set(e,JSON.stringify(n[e])):a.set(e,n[e])})),n=JSON.stringify(n)),fetch(e,{method:t,mode:"cors",cache:"no-cache",headers:s,redirect:"follow",referrer:"no-referrer",body:r?a:n})}t.makeApiCall=function(e="",t={},n={},o){let i=r.CometChat.getInstance();return new Promise((c,u)=>{s.getEndPoint(e,t).then(t=>{let s={appId:r.CometChat.getAppId(),Accept:"application/json"};o||(s["Content-Type"]="application/json"),t.hasOwnProperty("isAdminApi")&&t.isAdminApi?i.getApiKey()?s.apiKey=i.getApiKey():u({error:`An apiKey is need to use the ${e} api.`}):i.getAuthToken()?s.authToken=i.getAuthToken():u({error:`An authToken is need to use the ${e} api.`}),a(t.endpoint,t.method,n,s,o).then(e=>e.json()).then(e=>{e.hasOwnProperty("data")?(e.data.hasOwnProperty("authToken")&&i.setAuthToken(e.data.authToken),c(e)):u(e)}).catch(e=>u)}).catch(e=>u)})},t.postData=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CustomError=class{constructor(e){this.code=e.code,this.name=e.name,this.message=e.message,this.details=e.details}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(27),o=n(2),i=n(20),a=n(13),c=n(0),u=n(29),l=(n(31),n(32),n(17)),h=n(10),d=n(9),p=n(33),f=n(12);class m{constructor(){this.messageHandlers=[],this.presenceHandlers=[],this.iqHandlers=[]}static getInstance(){return null!=this.xMPPConnectionHelper&&null!=this.xMPPConnectionHelper||(this.xMPPConnectionHelper=new m),this.xMPPConnectionHelper}XMPPConnect(e){s.isFalsy(e)&&(e=m.XMPP_BIND_URL),this.connection=new r.Strophe.Connection(m.XMPP_BIND_URL)}XMMPLogin(e,t=c.XMPP.deafult_password,n){s.isFalsy(this.connection)&&this.XMPPConnect(),this.connection.connected?n(r.Strophe.Status.CONNECTED):this.connection.connect(s.format(c.XMPP.jid_string,o.CometChat.getAppId(),e,m.XMPP_HOST,c.XMPP.xmpp_resource),t,e=>{s.isFalsy(n)||n(e),e==r.Strophe.Status.CONNECTED&&(this.connection.sendPresence(r.$pres().c("priority").t("1").up().c("status").t("online")),this.connection.muc.init(this.connection),this.connection.vcard.init(this.connection),this.connection.muc.join(s.format(c.XMPP.muc_jid_string,o.CometChat.getAppId(),"somegroup","call",c.XMPP.host),this.connection.jid),this.connection.muc.listRooms(o.CometChat.getAppId()+"."+c.XMPP.host,e=>{[...e.getElementsByTagName("item")].map(e=>{this.connection.muc.join(e.getAttribute("jid"),this.connection.jid)})}),this.connection.send(r.$iq({from:r.Strophe.getBareJidFromJid(this.connection.jid),id:"enable1",type:"set"}).c("enable",{xmlns:"urn:xmpp:carbons:2"})),this.connection.addHandler(e=>{if(e.getElementsByTagName("x").length>0)console.log("Presence manager Main=>",{presence:e});else{let t=u.PresenceController.transformPresence(e);this.getUsersVCard(t.getUid(),e=>{s.isFalsy(e.getUid())||this.presenceHandlers.map(n=>{if(n)switch(e.setLastActiveAt(t.getLastActiveAt()),t.getStatus()){case c.PresenceConstatnts.STATUS.ONLINE:e.setStatus(c.PresenceConstatnts.STATUS.ONLINE),n._eventHander.onUserOnline(e);break;default:e.setStatus(c.PresenceConstatnts.STATUS.OFFLINE),n._eventHander.onUserOffline(e)}})})}return!0},null,"presence"),this.connection.addHandler(e=>{e.getElementsByTagName("vCard")[0]&&console.log("incoming iq ",e.getElementsByTagName("vCard")[0]);let t=[...e.getElementsByTagName("presence")];return t.length>0&&this.iqHandlers.map(e=>{e._callback(u.PresenceController.transformPresences(t))}),!0},null,"iq"),this.connection.addHandler(e=>(console.log("Incoming Method=>",{message:e}),console.log(this.messageHandlers),this.messageHandlers.map(t=>{try{console.log(console.log("Incoming Method=>",{message:e})),e=a.MessageController.trasformXMPPMessage(e),h.MessagesStore.getInstance().storeMessages([e])}catch(e){console.log("Incoming Method=> Inside Event Handler",{e:e})}t._eventHander&&(console.log(console.log("Incoming Method=> Inside Event Handler")),e instanceof l.Action?t._eventHander.onActionReceived(e):e instanceof f.Call?t._eventHander.onCallReceived(e):t._eventHander.onMessageReceived(e))}),!0),null,"message"))})}getPresenceInfo(e,t){let n="somename"+(new Date).getTime();this.addIqHandler(n,e=>{t(e)});let s=r.$iq({from:this.connection.jid,id:"CC^COMETCHAT-PRESENCE",type:"get",to:c.XMPP.host}).c("query",{xmlns:"jabber:iq:presencereq",action:"presence"}).t(JSON.stringify(e));this.connection.send(s)}addMessageListner(e,t,n){this.messageHandlers=[...this.messageHandlers,new i.MessageListner(e,n)]}removeMessageListner(e){this.messageHandlers=this.messageHandlers.filter(t=>t._name!==e)}addPresenceListner(e,t,n){this.presenceHandlers=[...this.presenceHandlers,new i.PresenceListner(e,n)]}removePresenceListner(e){this.presenceHandlers=this.presenceHandlers.filter(t=>t._name!==e)}addIqHandler(e,t){this.iqHandlers=[...this.iqHandlers,new i.Listner(e,t)]}removeIqHandler(e){this.iqHandlers=this.iqHandlers.filter(t=>t._name!==e)}joinMuc(e){console.log(s.format(c.XMPP.muc_jid_string,o.CometChat.getAppId(),e.$guid,o.CometChat.getAppId(),c.XMPP.host)),console.log(this.connection),this.connection.muc.join(s.format(c.XMPP.muc_jid_string,o.CometChat.getAppId(),e.$guid,o.CometChat.getAppId(),c.XMPP.host),this.connection.jid)}leaveMuc(e){console.log(s.format(c.XMPP.muc_jid_string,o.CometChat.getAppId(),e,o.CometChat.getAppId(),c.XMPP.host)),this.connection.muc.leave(s.format(c.XMPP.muc_jid_string,o.CometChat.getAppId(),e,o.CometChat.getAppId(),c.XMPP.host),this.connection.jid)}getUsersVCard(e,t){console.log("userId:=>"+d.getJidFromUid(e)),this.connection.vcard.get(e=>{t(p.VCardController.transformVCard(e))},d.getJidFromUid(e))}trigerMessageHandler(e,t){s.isFalsy(t)?this.messageHandlers.map(t=>{e=a.MessageController.trasformXMPPMessage(e),t._eventHander&&(e instanceof l.Action?t._eventHander.onActionReceived(e):e instanceof f.Call?t._eventHander.onCallReceived(e):t._eventHander.onMessageReceived(e)),h.MessagesStore.getInstance().storeMessages([e]),t._callback(a.MessageController.trasformXMPPMessage(e))}):this.messageHandlers[t]._eventHander&&(e instanceof l.Action?this.messageHandlers[t]._eventHander.onActionReceived(e):e instanceof f.Call?this.messageHandlers[t]._eventHander.onCallReceived(e):this.messageHandlers[t]._eventHander.onMessageReceived(e))}}m.XMPP_HOST=c.XMPP.host,m.XMPP_PORT=c.XMPP.port,m.xMPPConnectionHelper=new m,m.XMPP_BIND_URL="http://"+m.XMPP_HOST+":"+m.XMPP_PORT+c.XMPP.bind_url,t.XMPPConnectionHelper=m},function(e,t,n){var s;window,s=function(){return function(e){var t={};function n(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(s,r,function(t){return e[t]}.bind(null,r));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./src/strophe.js")}({"./node_modules/webpack/buildin/global.js":
/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
/*! no static exports found */function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},"./src/bosh.js":
/*!*********************!*\
  !*** ./src/bosh.js ***!
  \*********************/
/*! no exports provided */function(e,t,n){"use strict";n.r(t);var s=n(/*! core */"./src/core.js"),r=s.default.Strophe,o=s.default.$build;r.Request=function(e,t,n,s){this.id=++r._requestId,this.xmlData=e,this.data=r.serialize(e),this.origFunc=t,this.func=t,this.rid=n,this.date=NaN,this.sends=s||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()},r.Request.prototype={getResponse:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if("parsererror"===(e=this.xhr.responseXML.documentElement).tagName)throw r.error("invalid response received"),r.error("responseText: "+this.xhr.responseText),r.error("responseXML: "+r.serialize(this.xhr.responseXML)),new Error("parsererror")}else if(this.xhr.responseText){if(r.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),!(e=(new DOMParser).parseFromString(this.xhr.responseText,"application/xml").documentElement))throw new Error("Parsing produced null node");if(e.querySelector("parsererror")){r.error("invalid response received: "+e.querySelector("parsererror").textContent),r.error("responseText: "+this.xhr.responseText);var t=new Error;throw t.name=r.ErrorCondition.BAD_FORMAT,t}}return e},_newXHR:function(){var e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest).overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8"):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},r.Bosh=function(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.lastResponseHeaders=null,this._requests=[]},r.Bosh.prototype={strip:null,_buildBody:function(){var e=o("body",{rid:this.rid++,xmlns:r.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),e},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(e,t,n){this.wait=e||this.wait,this.hold=t||this.hold,this.errors=0;var s=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":r.NS.BOSH});n&&s.attrs({route:n});var o=this._conn._connect_cb;this._requests.push(new r.Request(s.tree(),this._onRequestStateChange.bind(this,o.bind(this._conn)),s.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(e,t,n,s,o,i,a){this._conn.jid=e,this.sid=t,this.rid=n,this._conn.connect_callback=s,this._conn.domain=r.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=o||this.wait,this.hold=i||this.hold,this.window=a||this.window,this._conn._changeConnectStatus(r.Status.ATTACHED,null)},_restore:function(e,t,n,s,o){var i=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(null!=i&&i.rid&&i.sid&&i.jid&&(null==e||r.getBareJidFromJid(i.jid)===r.getBareJidFromJid(e)||null===r.getNodeFromJid(e)&&r.getDomainFromJid(i.jid)===e))){var a=new Error("_restore: no restoreable session.");throw a.name="StropheSessionError",a}this._conn.restored=!0,this._attach(i.jid,i.sid,i.rid,t,n,s,o)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(e){var t=e.getAttribute("type");if(null!==t&&"terminate"===t){var n=e.getAttribute("condition");r.error("BOSH-Connection failed: "+n);var s=e.getElementsByTagName("conflict");return null!==n?("remote-stream-error"===n&&s.length>0&&(n="conflict"),this._conn._changeConnectStatus(r.Status.CONNFAIL,n)):this._conn._changeConnectStatus(r.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(n),r.Status.CONNFAIL}this.sid||(this.sid=e.getAttribute("sid"));var o=e.getAttribute("requests");o&&(this.window=parseInt(o,10));var i=e.getAttribute("hold");i&&(this.hold=parseInt(i,10));var a=e.getAttribute("wait");a&&(this.wait=parseInt(a,10));var c=e.getAttribute("inactivity");c&&(this.inactivity=parseInt(c,10))},_disconnect:function(e){this._sendTerminate(e)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(e){var t=this._getRequestStatus(e),n=this._conn.protocolErrorHandlers.HTTP[t];n&&n.call(this,t)},_hitError:function(e){this.errors++,r.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(e){r.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);var t=this._buildBody();this._requests.push(new r.Request(t.tree(),this._onRequestStateChange.bind(this,e),t.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(;this._requests.length>0;){var e=this._requests.pop();e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}}},_onIdle:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(r.info("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){for(var t=this._buildBody(),n=0;n<e.length;n++)null!==e[n]&&("restart"===e[n]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":r.NS.BOSH}):t.cnode(e[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new r.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var s=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(r.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),s>Math.floor(r.TIMEOUT*this.wait)&&(r.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(r.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_getRequestStatus:function(e,t){var n;if(4===e.xhr.readyState)try{n=e.xhr.status}catch(e){r.error("Caught an error while retrieving a request's status, reqStatus: "+n)}return void 0===n&&(n="number"==typeof t?t:0),n},_onRequestStateChange:function(e,t){if(r.debug("request id "+t.id+"."+t.sends+" state changed to "+t.xhr.readyState),t.abort)t.abort=!1;else if(4===t.xhr.readyState){var n=this._getRequestStatus(t);if(this.lastResponseHeaders=t.xhr.getAllResponseHeaders(),this.disconnecting&&n>=400)return this._hitError(n),void this._callProtocolErrorHandlers(t);var s=n>0&&n<500,o=t.sends>this._conn.maxRetries;if((s||o)&&(this._removeRequest(t),r.debug("request id "+t.id+" should now be removed")),200===n){var i=this._requests[0]===t;(this._requests[1]===t||i&&this._requests.length>0&&this._requests[0].age()>Math.floor(r.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(t.rid)+1),r.debug("request id "+t.id+"."+t.sends+" got 200"),e(t),this.errors=0}else 0===n||n>=400&&n<600||n>=12e3?(r.error("request id "+t.id+"."+t.sends+" error "+n+" happened"),this._hitError(n),this._callProtocolErrorHandlers(t),n>=400&&n<500&&(this._conn._changeConnectStatus(r.Status.DISCONNECTING,null),this._conn._doDisconnect())):r.error("request id "+t.id+"."+t.sends+" error "+n+" happened");s||o?o&&!this._conn.connected&&this._conn._changeConnectStatus(r.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}},_processRequest:function(e){var t=this,n=this._requests[e],s=this._getRequestStatus(n,-1);if(n.sends>this._conn.maxRetries)this._conn._onDisconnectTimeout();else{var o=n.age(),i=!isNaN(o)&&o>Math.floor(r.TIMEOUT*this.wait),a=null!==n.dead&&n.timeDead()>Math.floor(r.SECONDARY_TIMEOUT*this.wait),c=4===n.xhr.readyState&&(s<1||s>=500);if((i||a||c)&&(a&&r.error("Request ".concat(this._requests[e].id," timed out (secondary), restarting")),n.abort=!0,n.xhr.abort(),n.xhr.onreadystatechange=function(){},this._requests[e]=new r.Request(n.xmlData,n.origFunc,n.rid,n.sends),n=this._requests[e]),0===n.xhr.readyState){r.debug("request id "+n.id+"."+n.sends+" posting");try{var u=this._conn.options.contentType||"text/xml; charset=utf-8";n.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==n.xhr.setRequestHeader&&n.xhr.setRequestHeader("Content-Type",u),this._conn.options.withCredentials&&(n.xhr.withCredentials=!0)}catch(e){return r.error("XHR open failed: "+e.toString()),this._conn.connected||this._conn._changeConnectStatus(r.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var l=function(){if(n.date=new Date,t._conn.options.customHeaders){var e=t._conn.options.customHeaders;for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&n.xhr.setRequestHeader(s,e[s])}n.xhr.send(n.data)};if(n.sends>1){var h=1e3*Math.min(Math.floor(r.TIMEOUT*this.wait),Math.pow(n.sends,3));setTimeout(function(){l()},h)}else l();n.sends++,this._conn.xmlOutput!==r.Connection.prototype.xmlOutput&&(n.xmlData.nodeName===this.strip&&n.xmlData.childNodes.length?this._conn.xmlOutput(n.xmlData.childNodes[0]):this._conn.xmlOutput(n.xmlData)),this._conn.rawOutput!==r.Connection.prototype.rawOutput&&this._conn.rawOutput(n.data)}else r.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+n.xhr.readyState)}},_removeRequest:function(e){r.debug("removing request");for(var t=this._requests.length-1;t>=0;t--)e===this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(e){var t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)},_reqToData:function(e){try{return e.getResponse()}catch(e){if("parsererror"!==e.message)throw e;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(e){r.info("_sendTerminate was called");var t=this._buildBody().attrs({type:"terminate"});e&&t.cnode(e.tree());var n=new r.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"));this._requests.push(n),this._throttledRequestHandler()},_send:function(){var e=this;clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(function(){return e._conn._onIdle()},100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?r.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):r.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}}},"./src/core.js":
/*!*********************!*\
  !*** ./src/core.js ***!
  \*********************/
/*! exports provided: Strophe, $build, $iq, $msg, $pres, SHA1, MD5, default */function(e,t,n){"use strict";n.r(t),n.d(t,"Strophe",function(){return d}),n.d(t,"$build",function(){return c}),n.d(t,"$iq",function(){return l}),n.d(t,"$msg",function(){return u}),n.d(t,"$pres",function(){return h});var s=n(/*! md5 */"./src/md5.js");n.d(t,"MD5",function(){return s.default});var r=n(/*! sha1 */"./src/sha1.js");n.d(t,"SHA1",function(){return r.default});var o=n(/*! utils */"./src/utils.js");function i(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){return new d.Builder(e,t)}function u(e){return new d.Builder("message",e)}function l(e){return new d.Builder("iq",e)}function h(e){return new d.Builder("presence",e)}var d={VERSION:"1.3.1",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(e){for(var t=0;t<d.XHTML.tags.length;t++)if(e===d.XHTML.tags[t])return!0;return!1},validAttribute:function(e,t){if(void 0!==d.XHTML.attributes[e]&&d.XHTML.attributes[e].length>0)for(var n=0;n<d.XHTML.attributes[e].length;n++)if(t===d.XHTML.attributes[e][n])return!0;return!1},validCSS:function(e){for(var t=0;t<d.XHTML.css.length;t++)if(e===d.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},ErrorCondition:{BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(e,t){d.NS[e]=t},forEachChild:function(e,t,n){for(var s=0;s<e.childNodes.length;s++){var r=e.childNodes[s];r.nodeType!==d.ElementType.NORMAL||t&&!this.isTagEqual(r,t)||n(r)}},isTagEqual:function(e,t){return e.tagName===t},_xmlGenerator:null,_makeGenerator:function(){var e;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(e=this._getIEXmlDom()).appendChild(e.createElement("strophe")):e=document.implementation.createDocument("jabber:client","strophe",null),e},xmlGenerator:function(){return d._xmlGenerator||(d._xmlGenerator=d._makeGenerator()),d._xmlGenerator},_getIEXmlDom:function(){for(var e=null,t=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<t.length&&null===e;n++)try{e=new ActiveXObject(t[n])}catch(t){e=null}return e},xmlElement:function(e){if(!e)return null;for(var t=d.xmlGenerator().createElement(e),n=1;n<arguments.length;n++){var s=arguments[n];if(s)if("string"==typeof s||"number"==typeof s)t.appendChild(d.xmlTextNode(s));else if("object"===a(s)&&"function"==typeof s.sort)for(var r=0;r<s.length;r++){var o=s[r];"object"===a(o)&&"function"==typeof o.sort&&void 0!==o[1]&&null!==o[1]&&t.setAttribute(o[0],o[1])}else if("object"===a(s))for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&void 0!==s[i]&&null!==s[i]&&t.setAttribute(i,s[i])}return t},xmlescape:function(e){return e=(e=(e=(e=(e=e.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")},xmlunescape:function(e){return e=(e=(e=(e=(e=e.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')},xmlTextNode:function(e){return d.xmlGenerator().createTextNode(e)},xmlHtmlNode:function(e){var t;DOMParser?t=(new DOMParser).parseFromString(e,"text/xml"):((t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e));return t},getText:function(e){if(!e)return null;var t="";0===e.childNodes.length&&e.nodeType===d.ElementType.TEXT&&(t+=e.nodeValue);for(var n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType===d.ElementType.TEXT&&(t+=e.childNodes[n].nodeValue);return d.xmlescape(t)},copyElement:function(e){var t;if(e.nodeType===d.ElementType.NORMAL){t=d.xmlElement(e.tagName);for(var n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].nodeName,e.attributes[n].value);for(var s=0;s<e.childNodes.length;s++)t.appendChild(d.copyElement(e.childNodes[s]))}else e.nodeType===d.ElementType.TEXT&&(t=d.xmlGenerator().createTextNode(e.nodeValue));return t},createHtml:function(e){var t;if(e.nodeType===d.ElementType.NORMAL){var n=e.nodeName.toLowerCase();if(d.XHTML.validTag(n))try{t=d.xmlElement(n);for(var s=0;s<d.XHTML.attributes[n].length;s++){var r=d.XHTML.attributes[n][s],o=e.getAttribute(r);if(null!=o&&""!==o&&!1!==o&&0!==o)if("style"===r&&"object"===a(o)&&void 0!==o.cssText&&(o=o.cssText),"style"===r){for(var i=[],c=o.split(";"),u=0;u<c.length;u++){var l=c[u].split(":"),h=l[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(d.XHTML.validCSS(h)){var p=l[1].replace(/^\s*/,"").replace(/\s*$/,"");i.push(h+": "+p)}}i.length>0&&(o=i.join("; "),t.setAttribute(r,o))}else t.setAttribute(r,o)}for(var f=0;f<e.childNodes.length;f++)t.appendChild(d.createHtml(e.childNodes[f]))}catch(e){t=d.xmlTextNode("")}else{t=d.xmlGenerator().createDocumentFragment();for(var m=0;m<e.childNodes.length;m++)t.appendChild(d.createHtml(e.childNodes[m]))}}else if(e.nodeType===d.ElementType.FRAGMENT){t=d.xmlGenerator().createDocumentFragment();for(var _=0;_<e.childNodes.length;_++)t.appendChild(d.createHtml(e.childNodes[_]))}else e.nodeType===d.ElementType.TEXT&&(t=d.xmlTextNode(e.nodeValue));return t},escapeNode:function(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(e){return e.indexOf("@")<0?null:e.split("@")[0]},getDomainFromJid:function(e){var t=d.getBareJidFromJid(e);if(t.indexOf("@")<0)return t;var n=t.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(e){var t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(e){return e?e.split("/")[0]:null},_handleError:function(e){void 0!==e.stack&&d.fatal(e.stack),e.sourceURL?d.fatal("error: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message):e.fileName?d.fatal("error: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message):d.fatal("error: "+e.message)},log:function(e,t){e===this.LogLevel.FATAL&&"object"===a(window.console)&&"function"==typeof window.console.error&&window.console.error(t)},debug:function(e){this.log(this.LogLevel.DEBUG,e)},info:function(e){this.log(this.LogLevel.INFO,e)},warn:function(e){this.log(this.LogLevel.WARN,e)},error:function(e){this.log(this.LogLevel.ERROR,e)},fatal:function(e){this.log(this.LogLevel.FATAL,e)},serialize:function(e){if(!e)return null;"function"==typeof e.tree&&(e=e.tree());var t=i(Array(e.attributes.length).keys()).map(function(t){return e.attributes[t].nodeName});t.sort();var n=t.reduce(function(t,n){return"".concat(t," ").concat(n,'="').concat(d.xmlescape(e.attributes.getNamedItem(n).value),'"')},"<".concat(e.nodeName));if(e.childNodes.length>0){n+=">";for(var s=0;s<e.childNodes.length;s++){var r=e.childNodes[s];switch(r.nodeType){case d.ElementType.NORMAL:n+=d.serialize(r);break;case d.ElementType.TEXT:n+=d.xmlescape(r.nodeValue);break;case d.ElementType.CDATA:n+="<![CDATA["+r.nodeValue+"]]>"}}n+="</"+e.nodeName+">"}else n+="/>";return n},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){d._connectionPlugins[e]=t},Builder:function(e,t){"presence"!==e&&"message"!==e&&"iq"!==e||(t&&!t.xmlns?t.xmlns=d.NS.CLIENT:t||(t={xmlns:d.NS.CLIENT})),this.nodeTree=d.xmlElement(e,t),this.node=this.nodeTree}};d.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return d.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(void 0===e[t]?this.node.removeAttribute(t):this.node.setAttribute(t,e[t]));return this},c:function(e,t,n){var s=d.xmlElement(e,t,n);return this.node.appendChild(s),"string"!=typeof n&&"number"!=typeof n&&(this.node=s),this},cnode:function(e){var t,n=d.xmlGenerator();try{t=void 0!==n.importNode}catch(e){t=!1}var s=t?n.importNode(e,!0):d.copyElement(e);return this.node.appendChild(s),this.node=s,this},t:function(e){var t=d.xmlTextNode(e);return this.node.appendChild(t),this},h:function(e){var t=document.createElement("body");t.innerHTML=e;for(var n=d.createHtml(t);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},d.Handler=function(e,t,n,s,r,o,i){this.handler=e,this.ns=t,this.name=n,this.type=s,this.id=r,this.options=i||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(d.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=o?d.getBareJidFromJid(o):null:this.from=o,this.user=!0},d.Handler.prototype={getNamespace:function(e){var t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t},namespaceMatch:function(e){var t=this,n=!1;return!this.ns||(d.forEachChild(e,null,function(e){t.getNamespace(e)===t.ns&&(n=!0)}),n||this.getNamespace(e)===this.ns)},isMatch:function(e){var t=e.getAttribute("from");this.options.matchBareFromJid&&(t=d.getBareJidFromJid(t));var n=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!d.isTagEqual(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)},run:function(e){var t=null;try{t=this.handler(e)}catch(e){throw d._handleError(e),e}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},d.TimedHandler=function(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0},d.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},d.Connection=function(e,t){var n=this;this.service=e,this.options=t||{};var s=this.options.protocol||"";for(var r in 0===e.indexOf("ws:")||0===e.indexOf("wss:")||0===s.indexOf("ws")?this._proto=new d.Websocket(this):this._proto=new d.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(function(){return n._onIdle()},100),o.default.addCookies(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),d._connectionPlugins)if(Object.prototype.hasOwnProperty.call(d._connectionPlugins,r)){var i=function(){};i.prototype=d._connectionPlugins[r],this[r]=new i,this[r].init(this)}},d.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});return"string"==typeof e||"number"==typeof e?t+":"+e:t+""},addProtocolErrorHandler:function(e,t,n){this.protocolErrorHandlers[e][t]=n},connect:function(e,t,n,s,r,o,i){this.jid=e,this.authzid=d.getBareJidFromJid(this.jid),this.authcid=i||d.getNodeFromJid(this.jid),this.pass=t,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=d.getDomainFromJid(this.jid),this._changeConnectStatus(d.Status.CONNECTING,null),this._proto._connect(s,r,o)},attach:function(e,t,n,s,r,o,i){if(!(this._proto instanceof d.Bosh)){var a=new Error('The "attach" method can only be used with a BOSH connection.');throw a.name="StropheSessionError",a}this._proto._attach(e,t,n,s,r,o,i)},restore:function(e,t,n,s,r){if(!this._sessionCachingSupported()){var o=new Error('The "restore" method can only be used with a BOSH connection.');throw o.name="StropheSessionError",o}this._proto._restore(e,t,n,s,r)},_sessionCachingSupported:function(){if(this._proto instanceof d.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1},xmlInput:function(e){},xmlOutput:function(e){},rawInput:function(e){},rawOutput:function(e){},nextValidRid:function(e){},send:function(e){if(null!==e){if("function"==typeof e.sort)for(var t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendPresence:function(e,t,n,s){var r=this,o=null;"function"==typeof e.tree&&(e=e.tree());var i=e.getAttribute("id");if(i||(i=this.getUniqueId("sendPresence"),e.setAttribute("id",i)),"function"==typeof t||"function"==typeof n){var a=this.addHandler(function(e){o&&r.deleteTimedHandler(o),"error"===e.getAttribute("type")?n&&n(e):t&&t(e)},null,"presence",null,i);s&&(o=this.addTimedHandler(s,function(){return r.deleteHandler(a),n&&n(null),!1}))}return this.send(e),i},sendIQ:function(e,t,n,s){var r=this,o=null;"function"==typeof e.tree&&(e=e.tree());var i=e.getAttribute("id");if(i||(i=this.getUniqueId("sendIQ"),e.setAttribute("id",i)),"function"==typeof t||"function"==typeof n){var a=this.addHandler(function(e){o&&r.deleteTimedHandler(o);var s=e.getAttribute("type");if("result"===s)t&&t(e);else{if("error"!==s){var i=new Error("Got bad IQ type of ".concat(s));throw i.name="StropheError",i}n&&n(e)}},null,"iq",["error","result"],i);s&&(o=this.addTimedHandler(s,function(){return r.deleteHandler(a),n&&n(null),!1}))}return this.send(e),i},_queueData:function(e){if(null===e||!e.tagName||!e.childNodes){var t=new Error("Cannot queue non-DOMElement.");throw t.name="StropheError",t}this._data.push(e)},_sendRestart:function(){var e=this;this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(function(){return e._onIdle()},100)},addTimedHandler:function(e,t){var n=new d.TimedHandler(e,t);return this.addTimeds.push(n),n},deleteTimedHandler:function(e){this.removeTimeds.push(e)},addHandler:function(e,t,n,s,r,o,i){var a=new d.Handler(e,t,n,s,r,o,i);return this.addHandlers.push(a),a},deleteHandler:function(e){this.removeHandlers.push(e);var t=this.addHandlers.indexOf(e);t>=0&&this.addHandlers.splice(t,1)},registerSASLMechanisms:function(e){this.mechanisms={},(e=e||[d.SASLAnonymous,d.SASLExternal,d.SASLMD5,d.SASLOAuthBearer,d.SASLXOAuth2,d.SASLPlain,d.SASLSHA1]).forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(e){this.mechanisms[e.prototype.name]=e},disconnect:function(e){if(this._changeConnectStatus(d.Status.DISCONNECTING,e),d.info("Disconnect was called because: "+e),this.connected){var t=!1;this.disconnecting=!0,this.authenticated&&(t=h({xmlns:d.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(t)}else d.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()},_changeConnectStatus:function(e,t,n){for(var s in d._connectionPlugins)if(Object.prototype.hasOwnProperty.call(d._connectionPlugins,s)){var r=this[s];if(r.statusChanged)try{r.statusChanged(e,t)}catch(e){d.error("".concat(s," plugin caused an exception changing status: ").concat(e))}}if(this.connect_callback)try{this.connect_callback(e,t,n)}catch(e){d._handleError(e),d.error("User connection callback caused an exception: ".concat(e))}},_doDisconnect:function(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),d.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(d.Status.DISCONNECTED,e),this.connected=!1},_dataRecv:function(e,t){var n=this;d.info("_dataRecv called");var s=this._proto._reqToData(e);if(null!==s){for(this.xmlInput!==d.Connection.prototype.xmlInput&&(s.nodeName===this._proto.strip&&s.childNodes.length?this.xmlInput(s.childNodes[0]):this.xmlInput(s)),this.rawInput!==d.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(d.serialize(s)));this.removeHandlers.length>0;){var r=this.removeHandlers.pop(),o=this.handlers.indexOf(r);o>=0&&this.handlers.splice(o,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())this._doDisconnect();else{var i=s.getAttribute("type");if(null!==i&&"terminate"===i){if(this.disconnecting)return;var a=s.getAttribute("condition"),c=s.getElementsByTagName("conflict");return null!==a?("remote-stream-error"===a&&c.length>0&&(a="conflict"),this._changeConnectStatus(d.Status.CONNFAIL,a)):this._changeConnectStatus(d.Status.CONNFAIL,d.ErrorCondition.UNKOWN_REASON),void this._doDisconnect(a)}d.forEachChild(s,null,function(e){var t=n.handlers;n.handlers=[];for(var s=0;s<t.length;s++){var r=t[s];try{!r.isMatch(e)||!n.authenticated&&r.user?n.handlers.push(r):r.run(e)&&n.handlers.push(r)}catch(e){d.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}}})}}},mechanisms:{},_connect_cb:function(e,t,n){var s;d.info("_connect_cb was called"),this.connected=!0;try{s=this._proto._reqToData(e)}catch(e){if(e.name!==d.ErrorCondition.BAD_FORMAT)throw e;this._changeConnectStatus(d.Status.CONNFAIL,d.ErrorCondition.BAD_FORMAT),this._doDisconnect(d.ErrorCondition.BAD_FORMAT)}if(s&&(this.xmlInput!==d.Connection.prototype.xmlInput&&(s.nodeName===this._proto.strip&&s.childNodes.length?this.xmlInput(s.childNodes[0]):this.xmlInput(s)),this.rawInput!==d.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(d.serialize(s))),this._proto._connect_cb(s)!==d.Status.CONNFAIL))if(s.getElementsByTagNameNS?s.getElementsByTagNameNS(d.NS.STREAM,"features").length>0:s.getElementsByTagName("stream:features").length>0||s.getElementsByTagName("features").length>0){var r=[],o=s.getElementsByTagName("mechanism");if(o.length>0)for(var i=0;i<o.length;i++){var a=d.getText(o[i]);this.mechanisms[a]&&r.push(this.mechanisms[a])}0!==r.length||0!==s.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(r):this._proto._no_auth_received(t)}else this._proto._no_auth_received(t)},sortMechanismsByPriority:function(e){for(var t=0;t<e.length-1;++t){for(var n=t,s=t+1;s<e.length;++s)e[s].prototype.priority>e[n].prototype.priority&&(n=s);if(n!==t){var r=e[t];e[t]=e[n],e[n]=r}}return e},_attemptSASLAuth:function(e){e=this.sortMechanismsByPriority(e||[]);for(var t=!1,n=0;n<e.length;++n)if(e[n].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new e[n],this._sasl_mechanism.onStart(this);var s=c("auth",{xmlns:d.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var r=this._sasl_mechanism.onChallenge(this,null);s.t(btoa(r))}this.send(s.tree()),t=!0;break}return t},_attemptLegacyAuth:function(){null===d.getNodeFromJid(this.jid)?(this._changeConnectStatus(d.Status.CONNFAIL,d.ErrorCondition.MISSING_JID_NODE),this.disconnect(d.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus(d.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(l({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:d.NS.AUTH}).c("username",{}).t(d.getNodeFromJid(this.jid)).tree()))},authenticate:function(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()},_sasl_challenge_cb:function(e){var t=atob(d.getText(e)),n=this._sasl_mechanism.onChallenge(this,t),s=c("response",{xmlns:d.NS.SASL});return""!==n&&s.t(btoa(n)),this.send(s.tree()),!0},_auth1_cb:function(e){var t=l({type:"set",id:"_auth_2"}).c("query",{xmlns:d.NS.AUTH}).c("username",{}).t(d.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return d.getResourceFromJid(this.jid)||(this.jid=d.getBareJidFromJid(this.jid)+"/strophe"),t.up().c("resource",{}).t(d.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1},_sasl_success_cb:function(e){var t=this;if(this._sasl_data["server-signature"]){var n,s=atob(d.getText(e)).match(/([a-z]+)=([^,]+)(,|$)/);if("v"===s[1]&&(n=s[2]),n!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}d.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var r=[],o=function(e,n){for(;e.length;)t.deleteHandler(e.pop());return t._sasl_auth1_cb(n),!1};return r.push(this._addSysHandler(function(e){return o(r,e)},null,"stream:features",null,null)),r.push(this._addSysHandler(function(e){return o(r,e)},d.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(e){this.features=e;for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];"bind"===n.nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0)}if(!this.do_bind)return this._changeConnectStatus(d.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var s=d.getResourceFromJid(this.jid);return s?this.send(l({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:d.NS.BIND}).c("resource",{}).t(s).tree()):this.send(l({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:d.NS.BIND}).tree()),!1},_sasl_bind_cb:function(e){var t;if("error"===e.getAttribute("type"))return d.info("SASL binding failed."),e.getElementsByTagName("conflict").length>0&&(t=d.ErrorCondition.CONFLICT),this._changeConnectStatus(d.Status.AUTHFAIL,t,e),!1;var n=e.getElementsByTagName("bind");if(!(n.length>0))return d.info("SASL binding failed."),this._changeConnectStatus(d.Status.AUTHFAIL,null,e),!1;var s=n[0].getElementsByTagName("jid");s.length>0&&(this.jid=d.getText(s[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(l({type:"set",id:"_session_auth_2"}).c("session",{xmlns:d.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(d.Status.CONNECTED,null)))},_sasl_session_cb:function(e){if("result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(d.Status.CONNECTED,null);else if("error"===e.getAttribute("type"))return d.info("Session creation failed."),this._changeConnectStatus(d.Status.AUTHFAIL,null,e),!1;return!1},_sasl_failure_cb:function(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(d.Status.AUTHFAIL,null,e),!1},_auth2_cb:function(e){return"result"===e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(d.Status.CONNECTED,null)):"error"===e.getAttribute("type")&&(this._changeConnectStatus(d.Status.AUTHFAIL,null,e),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(e,t){var n=new d.TimedHandler(e,t);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(e,t,n,s,r){var o=new d.Handler(e,t,n,s,r);return o.user=!1,this.addHandlers.push(o),o},_onDisconnectTimeout:function(){return d.info("_onDisconnectTimeout was called"),this._changeConnectStatus(d.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var e=this;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;){var t=this.removeTimeds.pop(),n=this.timedHandlers.indexOf(t);n>=0&&this.timedHandlers.splice(n,1)}for(var s=(new Date).getTime(),r=[],o=0;o<this.timedHandlers.length;o++){var i=this.timedHandlers[o];if(this.authenticated||!i.user)i.lastCalled+i.period-s<=0?i.run()&&r.push(i):r.push(i)}this.timedHandlers=r,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(function(){return e._onIdle()},100))}},d.SASLMechanism=function(e,t,n){this.name=e,this.isClientFirst=t,this.priority=n},d.SASLMechanism.prototype={test:function(e){return!0},onStart:function(e){this._connection=e},onChallenge:function(e,t){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},d.SASLAnonymous=function(){},d.SASLAnonymous.prototype=new d.SASLMechanism("ANONYMOUS",!1,20),d.SASLAnonymous.prototype.test=function(e){return null===e.authcid},d.SASLPlain=function(){},d.SASLPlain.prototype=new d.SASLMechanism("PLAIN",!0,50),d.SASLPlain.prototype.test=function(e){return null!==e.authcid},d.SASLPlain.prototype.onChallenge=function(e){var t=e.authzid;return t+="\0",t+=e.authcid,t+="\0",t+=e.pass,o.default.utf16to8(t)},d.SASLSHA1=function(){},d.SASLSHA1.prototype=new d.SASLMechanism("SCRAM-SHA-1",!0,70),d.SASLSHA1.prototype.test=function(e){return null!==e.authcid},d.SASLSHA1.prototype.onChallenge=function(e,t,n){var i=n||s.default.hexdigest(1234567890*Math.random()),a="n="+o.default.utf16to8(e.authcid);return a+=",r=",a+=i,e._sasl_data.cnonce=i,e._sasl_data["client-first-message-bare"]=a,a="n,,"+a,this.onChallenge=function(e,t){for(var n,s,i,a,c,u,l,h,d="c=biws,",p="".concat(e._sasl_data["client-first-message-bare"],",").concat(t,","),f=e._sasl_data.cnonce,m=/([a-z]+)=([^,]+)(,|$)/;t.match(m);){var _=t.match(m);switch(t=t.replace(_[0],""),_[1]){case"r":n=_[2];break;case"s":s=_[2];break;case"i":i=_[2]}}if(n.substr(0,f.length)!==f)return e._sasl_data={},e._sasl_failure_cb();p+=d+="r="+n,s=atob(s),s+="\0\0\0";var g=o.default.utf16to8(e.pass);for(a=u=r.default.core_hmac_sha1(g,s),l=1;l<i;l++){for(c=r.default.core_hmac_sha1(g,r.default.binb2str(u)),h=0;h<5;h++)a[h]^=c[h];u=c}a=r.default.binb2str(a);var S=r.default.core_hmac_sha1(a,"Client Key"),E=r.default.str_hmac_sha1(a,"Server Key"),A=r.default.core_hmac_sha1(r.default.str_sha1(r.default.binb2str(S)),p);for(e._sasl_data["server-signature"]=r.default.b64_hmac_sha1(E,p),h=0;h<5;h++)S[h]^=A[h];return d+=",p="+btoa(r.default.binb2str(S))},a},d.SASLMD5=function(){},d.SASLMD5.prototype=new d.SASLMechanism("DIGEST-MD5",!1,60),d.SASLMD5.prototype.test=function(e){return null!==e.authcid},d.SASLMD5.prototype._quote=function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},d.SASLMD5.prototype.onChallenge=function(e,t,n){for(var r=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,i=n||s.default.hexdigest(""+1234567890*Math.random()),a="",c=null,u="";t.match(r);){var l=t.match(r);switch(t=t.replace(l[0],""),l[2]=l[2].replace(/^"(.+)"$/,"$1"),l[1]){case"realm":a=l[2];break;case"nonce":u=l[2];break;case"qop":l[2];break;case"host":c=l[2]}}var h=e.servtype+"/"+e.domain;null!==c&&(h=h+"/"+c);var d=o.default.utf16to8(e.authcid+":"+a+":"+this._connection.pass),p=s.default.hash(d)+":"+u+":"+i,f="AUTHENTICATE:"+h,m="";return m+="charset=utf-8,",m+="username="+this._quote(o.default.utf16to8(e.authcid))+",",m+="realm="+this._quote(a)+",",m+="nonce="+this._quote(u)+",",m+="nc=00000001,",m+="cnonce="+this._quote(i)+",",m+="digest-uri="+this._quote(h)+",",m+="response="+s.default.hexdigest(s.default.hexdigest(p)+":"+u+":00000001:"+i+":auth:"+s.default.hexdigest(f))+",",m+="qop=auth",this.onChallenge=function(){return""},m},d.SASLOAuthBearer=function(){},d.SASLOAuthBearer.prototype=new d.SASLMechanism("OAUTHBEARER",!0,40),d.SASLOAuthBearer.prototype.test=function(e){return null!==e.pass},d.SASLOAuthBearer.prototype.onChallenge=function(e){var t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="",t+="auth=Bearer ",t+=e.pass,t+="",t+="",o.default.utf16to8(t)},d.SASLExternal=function(){},d.SASLExternal.prototype=new d.SASLMechanism("EXTERNAL",!0,10),d.SASLExternal.prototype.onChallenge=function(e){return e.authcid===e.authzid?"":e.authzid},d.SASLXOAuth2=function(){},d.SASLXOAuth2.prototype=new d.SASLMechanism("X-OAUTH2",!0,30),d.SASLXOAuth2.prototype.test=function(e){return null!==e.pass},d.SASLXOAuth2.prototype.onChallenge=function(e){var t="\0";return null!==e.authcid&&(t+=e.authzid),t+="\0",t+=e.pass,o.default.utf16to8(t)},t.default={Strophe:d,$build:c,$iq:l,$msg:u,$pres:h,SHA1:r.default,MD5:s.default,b64_hmac_sha1:r.default.b64_hmac_sha1,b64_sha1:r.default.b64_sha1,str_hmac_sha1:r.default.str_hmac_sha1,str_sha1:r.default.str_sha1}},"./src/md5.js":
/*!********************!*\
  !*** ./src/md5.js ***!
  \********************/
/*! exports provided: default */function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return h});var s=function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n},r=function(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},o=function(e,t,n,r,o,i){return s((a=s(s(t,e),s(r,i)))<<(c=o)|a>>>32-c,n);var a,c},i=function(e,t,n,s,r,i,a){return o(t&n|~t&s,e,t,r,i,a)},a=function(e,t,n,s,r,i,a){return o(t&s|n&~s,e,t,r,i,a)},c=function(e,t,n,s,r,i,a){return o(t^n^s,e,t,r,i,a)},u=function(e,t,n,s,r,i,a){return o(n^(t|~s),e,t,r,i,a)},l=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n,r,o,l,h=1732584193,d=-271733879,p=-1732584194,f=271733878,m=0;m<e.length;m+=16)n=h,r=d,o=p,l=f,h=i(h,d,p,f,e[m+0],7,-680876936),f=i(f,h,d,p,e[m+1],12,-389564586),p=i(p,f,h,d,e[m+2],17,606105819),d=i(d,p,f,h,e[m+3],22,-1044525330),h=i(h,d,p,f,e[m+4],7,-176418897),f=i(f,h,d,p,e[m+5],12,1200080426),p=i(p,f,h,d,e[m+6],17,-1473231341),d=i(d,p,f,h,e[m+7],22,-45705983),h=i(h,d,p,f,e[m+8],7,1770035416),f=i(f,h,d,p,e[m+9],12,-1958414417),p=i(p,f,h,d,e[m+10],17,-42063),d=i(d,p,f,h,e[m+11],22,-1990404162),h=i(h,d,p,f,e[m+12],7,1804603682),f=i(f,h,d,p,e[m+13],12,-40341101),p=i(p,f,h,d,e[m+14],17,-1502002290),d=i(d,p,f,h,e[m+15],22,1236535329),h=a(h,d,p,f,e[m+1],5,-165796510),f=a(f,h,d,p,e[m+6],9,-1069501632),p=a(p,f,h,d,e[m+11],14,643717713),d=a(d,p,f,h,e[m+0],20,-373897302),h=a(h,d,p,f,e[m+5],5,-701558691),f=a(f,h,d,p,e[m+10],9,38016083),p=a(p,f,h,d,e[m+15],14,-660478335),d=a(d,p,f,h,e[m+4],20,-405537848),h=a(h,d,p,f,e[m+9],5,568446438),f=a(f,h,d,p,e[m+14],9,-1019803690),p=a(p,f,h,d,e[m+3],14,-187363961),d=a(d,p,f,h,e[m+8],20,1163531501),h=a(h,d,p,f,e[m+13],5,-1444681467),f=a(f,h,d,p,e[m+2],9,-51403784),p=a(p,f,h,d,e[m+7],14,1735328473),d=a(d,p,f,h,e[m+12],20,-1926607734),h=c(h,d,p,f,e[m+5],4,-378558),f=c(f,h,d,p,e[m+8],11,-2022574463),p=c(p,f,h,d,e[m+11],16,1839030562),d=c(d,p,f,h,e[m+14],23,-35309556),h=c(h,d,p,f,e[m+1],4,-1530992060),f=c(f,h,d,p,e[m+4],11,1272893353),p=c(p,f,h,d,e[m+7],16,-155497632),d=c(d,p,f,h,e[m+10],23,-1094730640),h=c(h,d,p,f,e[m+13],4,681279174),f=c(f,h,d,p,e[m+0],11,-358537222),p=c(p,f,h,d,e[m+3],16,-722521979),d=c(d,p,f,h,e[m+6],23,76029189),h=c(h,d,p,f,e[m+9],4,-640364487),f=c(f,h,d,p,e[m+12],11,-421815835),p=c(p,f,h,d,e[m+15],16,530742520),d=c(d,p,f,h,e[m+2],23,-995338651),h=u(h,d,p,f,e[m+0],6,-198630844),f=u(f,h,d,p,e[m+7],10,1126891415),p=u(p,f,h,d,e[m+14],15,-1416354905),d=u(d,p,f,h,e[m+5],21,-57434055),h=u(h,d,p,f,e[m+12],6,1700485571),f=u(f,h,d,p,e[m+3],10,-1894986606),p=u(p,f,h,d,e[m+10],15,-1051523),d=u(d,p,f,h,e[m+1],21,-2054922799),h=u(h,d,p,f,e[m+8],6,1873313359),f=u(f,h,d,p,e[m+15],10,-30611744),p=u(p,f,h,d,e[m+6],15,-1560198380),d=u(d,p,f,h,e[m+13],21,1309151649),h=u(h,d,p,f,e[m+4],6,-145523070),f=u(f,h,d,p,e[m+11],10,-1120210379),p=u(p,f,h,d,e[m+2],15,718787259),d=u(d,p,f,h,e[m+9],21,-343485551),h=s(h,n),d=s(d,r),p=s(p,o),f=s(f,l);return[h,d,p,f]},h={hexdigest:function(e){return function(e){for(var t="",n=0;n<4*e.length;n++)t+="0123456789abcdef".charAt(e[n>>2]>>n%4*8+4&15)+"0123456789abcdef".charAt(e[n>>2]>>n%4*8&15);return t}(l(r(e),8*e.length))},hash:function(e){return function(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}(l(r(e),8*e.length))}}},"./src/sha1.js":
/*!*********************!*\
  !*** ./src/sha1.js ***!
  \*********************/
/*! exports provided: default */function(e,t,n){"use strict";function s(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;var n,s,i,u,l,h,d,p,f=new Array(80),m=1732584193,_=-271733879,g=-1732584194,S=271733878,E=-1009589776;for(n=0;n<e.length;n+=16){for(u=m,l=_,h=g,d=S,p=E,s=0;s<80;s++)f[s]=s<16?e[n+s]:c(f[s-3]^f[s-8]^f[s-14]^f[s-16],1),i=a(a(c(m,5),r(s,_,g,S)),a(a(E,f[s]),o(s))),E=S,S=g,g=c(_,30),_=m,m=i;m=a(m,u),_=a(_,l),g=a(g,h),S=a(S,d),E=a(E,p)}return[m,_,g,S,E]}function r(e,t,n,s){return e<20?t&n|~t&s:e<40?t^n^s:e<60?t&n|t&s|n&s:t^n^s}function o(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function i(e,t){var n=u(e);n.length>16&&(n=s(n,8*e.length));for(var r=new Array(16),o=new Array(16),i=0;i<16;i++)r[i]=909522486^n[i],o[i]=1549556828^n[i];var a=s(r.concat(u(t)),512+8*t.length);return s(o.concat(a),672)}function a(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function c(e,t){return e<<t|e>>>32-t}function u(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<24-n%32;return t}function l(e){for(var t,n,s="",r=0;r<4*e.length;r+=3)for(t=(e[r>>2]>>8*(3-r%4)&255)<<16|(e[r+1>>2]>>8*(3-(r+1)%4)&255)<<8|e[r+2>>2]>>8*(3-(r+2)%4)&255,n=0;n<4;n++)8*r+6*n>32*e.length?s+="=":s+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>6*(3-n)&63);return s}function h(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}n.r(t),n.d(t,"default",function(){return d});var d={b64_hmac_sha1:function(e,t){return l(i(e,t))},b64_sha1:function(e){return l(s(u(e),8*e.length))},binb2str:h,core_hmac_sha1:i,str_hmac_sha1:function(e,t){return h(i(e,t))},str_sha1:function(e){return h(s(u(e),8*e.length))}}},"./src/strophe.js":
/*!************************!*\
  !*** ./src/strophe.js ***!
  \************************/
/*! exports provided: default */function(e,t,n){"use strict";n.r(t),function(e){var s=n(/*! core */"./src/core.js");n(/*! bosh */"./src/bosh.js"),n(/*! websocket */"./src/websocket.js");n.d(t,"default",function(){return s.default}),e.Strophe=s.default.Strophe,e.$build=s.default.$build,e.$iq=s.default.$iq,e.$msg=s.default.$msg,e.$pres=s.default.$pres}.call(this,n(/*! ./../node_modules/webpack/buildin/global.js */"./node_modules/webpack/buildin/global.js"))},"./src/utils.js":
/*!**********************!*\
  !*** ./src/utils.js ***!
  \**********************/
/*! exports provided: default */function(e,t,n){"use strict";function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.r(t),n.d(t,"default",function(){return r});var r={utf16to8:function(e){var t,n,s="",r=e.length;for(t=0;t<r;t++)(n=e.charCodeAt(t))>=0&&n<=127?s+=e.charAt(t):n>2047?(s+=String.fromCharCode(224|n>>12&15),s+=String.fromCharCode(128|n>>6&63),s+=String.fromCharCode(128|n>>0&63)):(s+=String.fromCharCode(192|n>>6&31),s+=String.fromCharCode(128|n>>0&63));return s},addCookies:function(e){for(var t in e=e||{})if(Object.prototype.hasOwnProperty.call(e,t)){var n="",r="",o="",i=e[t],a="object"===s(i),c=escape(unescape(a?i.value:i));a&&(n=i.expires?";expires="+i.expires:"",r=i.domain?";domain="+i.domain:"",o=i.path?";path="+i.path:""),document.cookie=t+"="+c+n+r+o}}}},"./src/websocket.js":
/*!**************************!*\
  !*** ./src/websocket.js ***!
  \**************************/
/*! no exports provided */function(e,t,n){"use strict";n.r(t);var s=n(/*! core */"./src/core.js"),r=s.default.Strophe,o=s.default.$build;r.Websocket=function(e){this._conn=e,this.strip="wrapper";var t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){var n="";"ws"===e.options.protocol&&"https:"!==window.location.protocol?n+="ws":n+="wss",n+="://"+window.location.host,0!==t.indexOf("/")?n+=window.location.pathname+t:n+=t,e.service=n}},r.Websocket.prototype={_buildStream:function(){return o("open",{xmlns:r.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(e,t){var n;if(0===(n=e.getElementsByTagNameNS?e.getElementsByTagNameNS(r.NS.STREAM,"error"):e.getElementsByTagName("stream:error")).length)return!1;for(var s=n[0],o="",i="",a=0;a<s.childNodes.length;a++){var c=s.childNodes[a];if("urn:ietf:params:xml:ns:xmpp-streams"!==c.getAttribute("xmlns"))break;"text"===c.nodeName?i=c.textContent:o=c.nodeName}var u="WebSocket stream error: ";return u+=o||"unknown",i&&(u+=" - "+i),r.error(u),this._conn._changeConnectStatus(t,o),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(e){if(this._check_streamerror(e,r.Status.CONNFAIL))return r.Status.CONNFAIL},_handleStreamStart:function(e){var t=!1,n=e.getAttribute("xmlns");"string"!=typeof n?t="Missing xmlns in <open />":n!==r.NS.FRAMING&&(t="Wrong xmlns in <open />: "+n);var s=e.getAttribute("version");return"string"!=typeof s?t="Missing version in <open />":"1.0"!==s&&(t="Wrong version in <open />: "+s),!t||(this._conn._changeConnectStatus(r.Status.CONNFAIL,t),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){var t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;var n=(new DOMParser).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data),this._handleStreamStart(n)&&this._connect_cb(n)}else if(0===e.data.indexOf("<close ")){var s=(new DOMParser).parseFromString(e.data,"text/xml").documentElement;this._conn.xmlInput(s),this._conn.rawInput(e.data);var o=s.getAttribute("see-other-uri");if(o){var i=this._conn.service;(i.indexOf("wss:")>=0&&o.indexOf("wss:")>=0||i.indexOf("ws:")>=0)&&(this._conn._changeConnectStatus(r.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=o,this._connect())}else this._conn._changeConnectStatus(r.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{var a=this._streamWrap(e.data),c=(new DOMParser).parseFromString(a,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(c,null,e.data)}},_disconnect:function(e){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){e&&this._conn.send(e);var t=o("close",{xmlns:r.NS.FRAMING});this._conn.xmlOutput(t.tree());var n=r.serialize(t);this._conn.rawOutput(n);try{this.socket.send(n)}catch(e){r.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){r.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(e){return"<wrapper>"+e+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.onerror=null,this.socket.close()}catch(e){r.debug(e.message)}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(e){this._conn.connected&&!this._conn.disconnecting?(r.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected&&this.socket?(r.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(r.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):r.info("Websocket closed")},_no_auth_received:function(e){r.error("Server did not offer a supported authentication mechanism"),this._changeConnectStatus(r.Status.CONNFAIL,r.ErrorCondition.NO_AUTH_MECH),e&&e.call(this._conn),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(e){r.error("Websocket error "+e),this._conn._changeConnectStatus(r.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var e=this._conn._data;if(e.length>0&&!this._conn.paused){for(var t=0;t<e.length;t++)if(null!==e[t]){var n=void 0;n="restart"===e[t]?this._buildStream().tree():e[t];var s=r.serialize(n);this._conn.xmlOutput(n),this._conn.rawOutput(s),this.socket.send(s)}this._conn._data=[]}},_onMessage:function(e){var t,n='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===n)return this._conn.rawInput(n),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(t=(new DOMParser).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else{var s=this._streamWrap(e.data);t=(new DOMParser).parseFromString(s,"text/xml").documentElement}return this._check_streamerror(t,r.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(r.serialize(t))):void this._conn._dataRecv(t,e.data)},_onOpen:function(){r.info("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var t=r.serialize(e);this._conn.rawOutput(t),this.socket.send(t)},_reqToData:function(e){return e},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}}}}).default},e.exports=s()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);class r{constructor(e,t,n,s){this.receiver=e,this.type=t,this.receiverType=n,this.category=s}getId(){return this.id}setId(e){this.id=e}getMuid(){return this.muid}setMuid(e){this.muid=e}getSender(){return this.sender}setSender(e){this.sender=e}getReceiver(){return this.receiver}setReceiver(e){this.receiver=e}getType(){return this.type}setType(e){this.type=e}get(){return this.id}setReceiverType(e){this.receiverType=e}getReceiverType(){return this.receiverType}setSentAt(e){this.sentAt=e}getSentAt(){return this.sentAt}getStatus(){return this.status}setStatus(e){this.status=e}}r.TYPE=s.MessageConstatnts.TYPE,r.RECEIVER_TYPE=s.MessageConstatnts.RECEIVER_TYPE,t.BaseMessage=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),r=n(1),o=n(2);t.getUidFromJid=function(e){return e.substring(e.lastIndexOf("]")+1,e.lastIndexOf("@"))},t.getappIdFromJid=function(e){return e.substring(e.lastIndexOf("[")+1,e.lastIndexOf("]"))},t.parseHTML=function(e){try{return e.textContent}catch(t){return e}},t.getJidFromUid=function(e){return r.format(s.XMPP.bare_jid_string,o.CometChat.getAppId(),e,s.XMPP.host)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(2),r=n(1),o=n(0),i=n(16);class a{constructor(e){this.store=o.constants.DEFAULT_STORE,r.isFalsy(e)||(this.store=e),this.messagesStore=i.createInstance({name:r.format(o.LOCAL_STORE.STORE_STRING,s.CometChat.getAppId(),o.LOCAL_STORE.MESSAGES_STORE)}),this.messagesStore.setDriver([i.LOCALSTORAGE,i.INDEXEDDB,i.WEBSQL])}static getInstance(){return null==a.MessagesStore&&(a.MessagesStore=new a),a.MessagesStore}set(e,t){return this.messagesStore.setItem(e,t)}remove(e){this.messagesStore.removeItem(e)}get(e){return this.messagesStore.getItem(e)}getAllMessages(){console.log({CometChat:s.CometChat});let e={};return new Promise((t,n)=>{this.messagesStore.iterate((t,n,s)=>{n!=o.constants.MSG_VER_POST&&n!=o.constants.MSG_VER_POST&&(e=Object.assign({},e,t))}).then(()=>{t(e)})})}clear(e){}selectStore(e){this.store=e}storeMessages(e){if(s.CometChat.getInstance().user.getUid()){let n=s.CometChat.getInstance().user.getUid();var t={};let r=0,i=0;return e.map(e=>{let s;0==r&&(r=parseInt(e.getId().toString())),r>e.getId()&&(r=parseInt(e.getId().toString())),i<e.getId()&&(i=parseInt(e.getId().toString())),s=e.getSender()instanceof Object?e.getSender().getUid():e.getSender(),"group"==e.getReceiverType()&&(s=e.getReceiver()),e.getSender()instanceof Object?e.getSender().getUid()==n&&(s=e.getReceiver()):e.getSender()==n&&(s=e.getReceiver()),t[s]||(t[s]={}),t[s]=Object.assign({},t[s],{[e.getId()]:e})}),this.get(o.constants.MSG_VER_PRE).then(e=>{(r>0&&e>r||null==e)&&this.set(o.constants.MSG_VER_PRE,r)})&&i>0&&this.set(o.constants.MSG_VER_POST,i),Object.keys(t).map(e=>{this.get(e).then(n=>{null==n&&(n={}),this.set(e,Object.assign({},t[e],n))})}),!0}}}t.MessagesStore=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);class r{constructor(e,t,n,s,o,i){this.Type=r.TYPE,this.guid=e,this.name=t,this.type=n,s&&(this.password=s),o&&(this.icon=o),i&&(this.description=i)}getGuid(){return this.guid}setGuid(e){this.guid=e}getName(){return this.name}setName(e){this.name=e}getType(){return this.type}setType(e){this.type=e}setPassword(e){this.password=e}getIcon(){return this.icon}setIcon(e){this.icon=e}getDescription(){return this.description}setDescription(e){this.description=e}getOwner(){return this.owner}setOwner(e){this.owner=e}getMetadata(){return this.metadata}setMetadata(e){this.metadata=e}getCreatedAt(){return this.createdAt}setCreatedAt(e){this.createdAt=e}getUpdatedAt(){return this.updatedAt}setUpdatedAt(e){this.updatedAt=e}getHasJoined(){return this.hasJoined}setHasJoined(e){this.hasJoined=e}getWsChannel(){return this.wsChannel}setWsChannel(e){this.wsChannel=e}get $wsChannel(){return this.wsChannel}set $wsChannel(e){this.wsChannel=e}get $guid(){return this.guid}get $name(){return this.name}get $type(){return this.type}get $password(){return this.password}get $icon(){return this.icon}get $description(){return this.description}get $owner(){return this.owner}get $metadata(){return this.metadata}get $createdAt(){return this.createdAt}get $updatedAt(){return this.updatedAt}get $hasJoined(){return this.hasJoined}set $guid(e){this.guid=e}set $name(e){this.name=e}set $type(e){this.type=e}set $password(e){this.password=e}set $icon(e){this.icon=e}set $description(e){this.description=e}set $owner(e){this.owner=e}set $metadata(e){this.metadata=e}set $createdAt(e){this.createdAt=e}set $updatedAt(e){this.updatedAt=e}set $hasJoined(e){this.hasJoined=e}}r.TYPE=s.GroupType,t.Group=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(8),r=n(0),o=n(3);class i extends s.BaseMessage{getData(){return this.data}setData(e){this.data=e}getSessionId(){return this.sessionId}setSessionId(e){this.sessionId=e}getCallStatus(){return this.callStatus}setCallStatus(e){this.callStatus=e}getMetadata(){return this.metadata}getSender(){return this.getSenderFromData()}setMetadata(e){this.metadata=e}getAction(){return this.action}setAction(e){this.action=e}getInitiatedAt(){return this.initiatedAt}setInitiatedAt(e){this.initiatedAt=e}setRawData(e){this.rawData=e}getRawData(){return this.rawData}static callFromJSON(e){let t=new this(e[r.MessageConstatnts.KEYS.RECEIVER],e[r.MessageConstatnts.KEYS.TYPE],e[r.MessageConstatnts.KEYS.RECEIVER_TYPE],r.MessageCategory.CALL),n=e[r.MessageConstatnts.KEYS.DATA];if(t.setAction(n[r.MessageConstatnts.KEYS.ACTION]),n[r.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON]){let e=n[r.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON];if(e[r.CallConstants.CALL_KEYS.CALL_ENTITY]){let n=e[r.CallConstants.CALL_KEYS.CALL_ENTITY];if(n[r.CallConstants.CALL_KEYS.CALL_SESSION_ID]&&(t.sessionId=n[r.CallConstants.CALL_KEYS.CALL_SESSION_ID]),n[r.CallConstants.CALL_KEYS.CALL_STATUS]&&(t.callStatus=n[r.CallConstants.CALL_KEYS.CALL_STATUS]),n[r.CallConstants.CALL_KEYS.CALL_DATA]){let e=n[r.CallConstants.CALL_KEYS.CALL_DATA];if(e[r.CallConstants.CALL_KEYS.CALL_METADATA]&&(t.metadata=e[r.CallConstants.CALL_KEYS.CALL_METADATA]),e[r.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES]){e[r.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES]}}n[r.CallConstants.CALL_KEYS.CALL_INITIATED_AT]&&(t.initiatedAt=n[r.CallConstants.CALL_KEYS.CALL_INITIATED_AT])}}return console.log({call:t}),t}getSenderFromData(){let e=this.getData();if(e[r.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][r.CallConstants.CALL_KEYS.CALL_ENTITY][r.CallConstants.CALL_KEYS.CALL_DATA][r.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][r.CallConstants.CALL_KEYS.CALL_SENDER])return console.log("this is sender",new o.AppUser(e[r.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][r.CallConstants.CALL_KEYS.CALL_ENTITY][r.CallConstants.CALL_KEYS.CALL_DATA][r.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][r.CallConstants.CALL_KEYS.CALL_SENDER][r.CallConstants.CALL_KEYS.CALL_ENTITY])),new o.AppUser(e[r.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][r.CallConstants.CALL_KEYS.CALL_ENTITY][r.CallConstants.CALL_KEYS.CALL_DATA][r.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][r.CallConstants.CALL_KEYS.CALL_SENDER][r.CallConstants.CALL_KEYS.CALL_ENTITY])}}i.ACTION_TYPE=r.ActionConstatnts.ACTION_TYPE,t.Call=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(14),r=n(9),o=n(15),i=n(4),a=n(10),c=n(1),u=n(0),l=n(6),h=n(17),d=n(12);class p{static trasformXMPPMessage(e){console.log("trasformJSONMessge",{msg:e});let t={};try{let n=JSON.parse(unescape(r.parseHTML(e.getElementsByTagName("body")[0])).trim().toString());t=this.trasformJSONMessge(n),console.log("trasformJSONMessge",{msg:e,JSONBody:n})}catch(e){return t}return t}static trasformJSONMessge(e){let t;switch(console.log("tranforming json message :",{message:e}),e.category){case u.MessageConstatnts.CATEGORY.ACTION:console.log("tranforming json message :",{message:e}),t=h.Action.actionFromJSON(e);break;case u.MessageConstatnts.CATEGORY.CALL:t=d.Call.callFromJSON(e);break;case u.MessageConstatnts.CATEGORY.MESSAGE:switch(e.type){case u.MessageConstatnts.TYPE.TEXT:t=new s.TextMessage(e[u.MessageConstatnts.KEYS.RECEIVER],e[u.MessageConstatnts.KEYS.DATA][u.MessageConstatnts.KEYS.TEXT],e[u.MessageConstatnts.KEYS.TYPE],e[u.MessageConstatnts.KEYS.RECEIVER_TYPE]);break;default:t=new o.MediaMessage(e[u.MessageConstatnts.KEYS.RECEIVER],e[u.MessageConstatnts.KEYS.DATA][u.MessageConstatnts.KEYS.URL],e[u.MessageConstatnts.KEYS.TYPE],e[u.MessageConstatnts.KEYS.RECEIVER_TYPE])}}try{Object.assign(t,e),e=t}catch(e){}return e}static getOfflineHistory(e=1e3,t=1){let n=a.MessagesStore.getInstance(),s=[];i.makeApiCall("getMessages",{},this.createData(e,t)).then(e=>(c.isFalsy(e.data)||e.data.map(e=>{l.XMPPConnectionHelper.getInstance().trigerMessageHandler(e),s.push(p.trasformJSONMessge(e))}),n.storeMessages(s)))}static createData(e,t=0){return{per_page:e,cursorValue:t,cursorField:u.MessageConstatnts.PAGINATION.CURSOR_FILEDS.ID,cursorAffix:c.isFalsy(t)?u.MessageConstatnts.PAGINATION.AFFIX.PREPEND:u.MessageConstatnts.PAGINATION.AFFIX.APPEND}}}t.MessageController=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(8),r=n(0),o=n(3);t.TextMessage=class extends s.BaseMessage{constructor(e,t,n,s){switch(super(e,n,s,r.MessageCategory.MESSAGE),n){case"text":this.data={text:t},this.text=t}}getSender(){return this.getSenderFromData()}getMeta(){return this.meta}setMeta(e){this.meta=e}getData(){return this.data}setData(e){this.data=e}getText(){return this.text}setText(e){this.text=e}getSenderFromData(){let e=this.getData();if(e[r.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][r.MessageConstatnts.KEYS.SENDER][r.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])return new o.AppUser(e[r.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][r.MessageConstatnts.KEYS.SENDER][r.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(8),r=n(0),o=n(3);t.MediaMessage=class extends s.BaseMessage{constructor(e,t,n,s){super(e,n,s,r.MessageCategory.MESSAGE),this.data={url:t instanceof File?void 0:t},this.file=t,t instanceof File||(this.url=t)}getSender(){return this.getSenderFromData()}getUrl(){return this.url}setUrl(e){this.url=e}get metaData(){return this._metaData}set metaData(e){this._metaData=e}getMeta(){return this.meta}setMeta(e){this.meta=e}getData(){return this.data}setData(e){this.data=e}getSenderFromData(){let e=this.getData();if(e[r.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][r.MessageConstatnts.KEYS.SENDER][r.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])return new o.AppUser(e[r.ResponseConstants.RESPONSE_KEYS.KEY_ENTITIES][r.MessageConstatnts.KEYS.SENDER][r.ResponseConstants.RESPONSE_KEYS.KEY_ENTITITY])}}},function(e,t,n){(function(t){var n;e.exports=function e(t,s,r){function o(a,c){if(!s[a]){if(!t[a]){var u="function"==typeof n&&n;if(!c&&u)return n(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var h=s[a]={exports:{}};t[a][0].call(h.exports,function(e){var n=t[a][1][e];return o(n||e)},h,h.exports,e,t,s,r)}return s[a].exports}for(var i="function"==typeof n&&n,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,n,s){(function(e){"use strict";var t,s,r=e.MutationObserver||e.WebKitMutationObserver;if(r){var o=0,i=new r(l),a=e.document.createTextNode("");i.observe(a,{characterData:!0}),t=function(){a.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)t="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){l(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(l,0)};else{var c=new e.MessageChannel;c.port1.onmessage=l,t=function(){c.port2.postMessage(0)}}var u=[];function l(){var e,t;s=!0;for(var n=u.length;n;){for(t=u,u=[],e=-1;++e<n;)t[e]();n=u.length}s=!1}n.exports=function(e){1!==u.push(e)||s||t()}}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var s=e(1);function r(){}var o={},i=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function u(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==r&&p(this,e)}function l(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function h(e,t,n){s(function(){var s;try{s=t(n)}catch(t){return o.reject(e,t)}s===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,s)})}function d(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function p(e,t){var n=!1;function s(t){n||(n=!0,o.reject(e,t))}function r(t){n||(n=!0,o.resolve(e,t))}var i=f(function(){t(r,s)});"error"===i.status&&s(i.value)}function f(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}t.exports=u,u.prototype.catch=function(e){return this.then(null,e)},u.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===i)return this;var n=new this.constructor(r);if(this.state!==c){var s=this.state===a?e:t;h(n,s,this.outcome)}else this.queue.push(new l(n,e,t));return n},l.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},l.prototype.otherCallFulfilled=function(e){h(this.promise,this.onFulfilled,e)},l.prototype.callRejected=function(e){o.reject(this.promise,e)},l.prototype.otherCallRejected=function(e){h(this.promise,this.onRejected,e)},o.resolve=function(e,t){var n=f(d,t);if("error"===n.status)return o.reject(e,n.value);var s=n.value;if(s)p(e,s);else{e.state=a,e.outcome=t;for(var r=-1,i=e.queue.length;++r<i;)e.queue[r].callFulfilled(t)}return e},o.reject=function(e,t){e.state=i,e.outcome=t;for(var n=-1,s=e.queue.length;++n<s;)e.queue[n].callRejected(t);return e},u.resolve=function(e){return e instanceof this?e:o.resolve(new this(r),e)},u.reject=function(e){var t=new this(r);return o.reject(t,e)},u.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,s=!1;if(!n)return this.resolve([]);for(var i=new Array(n),a=0,c=-1,u=new this(r);++c<n;)l(e[c],c);return u;function l(e,r){t.resolve(e).then(function(e){i[r]=e,++a!==n||s||(s=!0,o.resolve(u,i))},function(e){s||(s=!0,o.reject(u,e))})}},u.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,s=!1;if(!n)return this.resolve([]);for(var i,a=-1,c=new this(r);++a<n;)i=e[a],t.resolve(i).then(function(e){s||(s=!0,o.resolve(c,e))},function(e){s||(s=!0,o.reject(c,e))});return c}},{1:1}],3:[function(e,n,s){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function o(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(o){if("TypeError"!==o.name)throw o;for(var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,s=new n,r=0;r<e.length;r+=1)s.append(e[r]);return s.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var i=Promise;function a(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function c(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function u(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function l(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var h="local-forage-detect-blob-support",d=void 0,p={},f=Object.prototype.toString,m="readonly",_="readwrite";function g(e){return"boolean"==typeof d?i.resolve(d):function(e){return new i(function(t){var n=e.transaction(h,_),s=o([""]);n.objectStore(h).put(s,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}}).catch(function(){return!1})}(e).then(function(e){return d=e})}function S(e){var t=p[e.name],n={};n.promise=new i(function(e,t){n.resolve=e,n.reject=t}),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then(function(){return n.promise}):t.dbReady=n.promise}function E(e){var t=p[e.name],n=t.deferredOperations.pop();if(n)return n.resolve(),n.promise}function A(e,t){var n=p[e.name],s=n.deferredOperations.pop();if(s)return s.reject(t),s.promise}function C(e,t){return new i(function(n,s){if(p[e.name]=p[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);S(e),e.db.close()}var o=[e.name];t&&o.push(e.version);var i=r.open.apply(r,o);t&&(i.onupgradeneeded=function(t){var n=i.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(h)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),i.onerror=function(e){e.preventDefault(),s(i.error)},i.onsuccess=function(){n(i.result),E(e)}})}function T(e){return C(e,!1)}function v(e){return C(e,!0)}function y(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),s=e.version<e.db.version,r=e.version>e.db.version;if(s&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),r||n){if(n){var o=e.db.version+1;o>e.version&&(e.version=o)}return!0}return!1}function b(e){var t=function(e){for(var t=e.length,n=new ArrayBuffer(t),s=new Uint8Array(n),r=0;r<t;r++)s[r]=e.charCodeAt(r);return n}(atob(e.data));return o([t],{type:e.type})}function N(e){return e&&e.__local_forage_encoded_blob}function I(e){var t=this,n=t._initReady().then(function(){var e=p[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return c(n,e,e),n}function O(e,t,n,s){void 0===s&&(s=1);try{var r=e.db.transaction(e.storeName,t);n(null,r)}catch(r){if(s>0&&(!e.db||"InvalidStateError"===r.name||"NotFoundError"===r.name))return i.resolve().then(function(){if(!e.db||"NotFoundError"===r.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),v(e)}).then(function(){return function(e){S(e);for(var t=p[e.name],n=t.forages,s=0;s<n.length;s++){var r=n[s];r._dbInfo.db&&(r._dbInfo.db.close(),r._dbInfo.db=null)}return e.db=null,T(e).then(function(t){return e.db=t,y(e)?v(e):t}).then(function(s){e.db=t.db=s;for(var r=0;r<n.length;r++)n[r]._dbInfo.db=s}).catch(function(t){throw A(e,t),t})}(e).then(function(){O(e,t,n,s-1)})}).catch(n);n(r)}}var M={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var s in e)n[s]=e[s];var r=p[n.name];r||(r={forages:[],db:null,dbReady:null,deferredOperations:[]},p[n.name]=r),r.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=I);var o=[];function a(){return i.resolve()}for(var c=0;c<r.forages.length;c++){var u=r.forages[c];u!==t&&o.push(u._initReady().catch(a))}var l=r.forages.slice(0);return i.all(o).then(function(){return n.db=r.db,T(n)}).then(function(e){return n.db=e,y(n,t._defaultConfig.version)?v(n):e}).then(function(e){n.db=r.db=e,t._dbInfo=n;for(var s=0;s<l.length;s++){var o=l[s];o!==t&&(o._dbInfo.db=n.db,o._dbInfo.version=n.version)}})},_support:function(){try{if(!r)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,s=new i(function(t,s){n.ready().then(function(){O(n._dbInfo,m,function(r,o){if(r)return s(r);try{var i=o.objectStore(n._dbInfo.storeName),a=i.openCursor(),c=1;a.onsuccess=function(){var n=a.result;if(n){var s=n.value;N(s)&&(s=b(s));var r=e(s,n.key,c++);void 0!==r?t(r):n.continue()}else t()},a.onerror=function(){s(a.error)}}catch(e){s(e)}})}).catch(s)});return a(s,t),s},getItem:function(e,t){var n=this;e=u(e);var s=new i(function(t,s){n.ready().then(function(){O(n._dbInfo,m,function(r,o){if(r)return s(r);try{var i=o.objectStore(n._dbInfo.storeName),a=i.get(e);a.onsuccess=function(){var e=a.result;void 0===e&&(e=null),N(e)&&(e=b(e)),t(e)},a.onerror=function(){s(a.error)}}catch(e){s(e)}})}).catch(s)});return a(s,t),s},setItem:function(e,t,n){var s=this;e=u(e);var r=new i(function(n,r){var o;s.ready().then(function(){return o=s._dbInfo,"[object Blob]"===f.call(t)?g(o.db).then(function(e){return e?t:(n=t,new i(function(e,t){var s=new FileReader;s.onerror=t,s.onloadend=function(t){var s=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:s,type:n.type})},s.readAsBinaryString(n)}));var n}):t}).then(function(t){O(s._dbInfo,_,function(o,i){if(o)return r(o);try{var a=i.objectStore(s._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);i.oncomplete=function(){void 0===t&&(t=null),n(t)},i.onabort=i.onerror=function(){var e=c.error?c.error:c.transaction.error;r(e)}}catch(e){r(e)}})}).catch(r)});return a(r,n),r},removeItem:function(e,t){var n=this;e=u(e);var s=new i(function(t,s){n.ready().then(function(){O(n._dbInfo,_,function(r,o){if(r)return s(r);try{var i=o.objectStore(n._dbInfo.storeName),a=i.delete(e);o.oncomplete=function(){t()},o.onerror=function(){s(a.error)},o.onabort=function(){var e=a.error?a.error:a.transaction.error;s(e)}}catch(e){s(e)}})}).catch(s)});return a(s,t),s},clear:function(e){var t=this,n=new i(function(e,n){t.ready().then(function(){O(t._dbInfo,_,function(s,r){if(s)return n(s);try{var o=r.objectStore(t._dbInfo.storeName),i=o.clear();r.oncomplete=function(){e()},r.onabort=r.onerror=function(){var e=i.error?i.error:i.transaction.error;n(e)}}catch(e){n(e)}})}).catch(n)});return a(n,e),n},length:function(e){var t=this,n=new i(function(e,n){t.ready().then(function(){O(t._dbInfo,m,function(s,r){if(s)return n(s);try{var o=r.objectStore(t._dbInfo.storeName),i=o.count();i.onsuccess=function(){e(i.result)},i.onerror=function(){n(i.error)}}catch(e){n(e)}})}).catch(n)});return a(n,e),n},key:function(e,t){var n=this,s=new i(function(t,s){e<0?t(null):n.ready().then(function(){O(n._dbInfo,m,function(r,o){if(r)return s(r);try{var i=o.objectStore(n._dbInfo.storeName),a=!1,c=i.openCursor();c.onsuccess=function(){var n=c.result;n?0===e?t(n.key):a?t(n.key):(a=!0,n.advance(e)):t(null)},c.onerror=function(){s(c.error)}}catch(e){s(e)}})}).catch(s)});return a(s,t),s},keys:function(e){var t=this,n=new i(function(e,n){t.ready().then(function(){O(t._dbInfo,m,function(s,r){if(s)return n(s);try{var o=r.objectStore(t._dbInfo.storeName),i=o.openCursor(),a=[];i.onsuccess=function(){var t=i.result;t?(a.push(t.key),t.continue()):e(a)},i.onerror=function(){n(i.error)}}catch(e){n(e)}})}).catch(n)});return a(n,e),n},dropInstance:function(e,t){t=l.apply(this,arguments);var n,s=this.config();if((e="function"!=typeof e&&e||{}).name||(e.name=e.name||s.name,e.storeName=e.storeName||s.storeName),e.name){var o=e.name===s.name&&this._dbInfo.db,c=o?i.resolve(this._dbInfo.db):T(e).then(function(t){var n=p[e.name],s=n.forages;n.db=t;for(var r=0;r<s.length;r++)s[r]._dbInfo.db=t;return t});n=e.storeName?c.then(function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;S(e);var s=p[e.name],o=s.forages;t.close();for(var a=0;a<o.length;a++){var c=o[a];c._dbInfo.db=null,c._dbInfo.version=n}var u=new i(function(t,s){var o=r.open(e.name,n);o.onerror=function(e){var t=o.result;t.close(),s(e)},o.onupgradeneeded=function(){var t=o.result;t.deleteObjectStore(e.storeName)},o.onsuccess=function(){var e=o.result;e.close(),t(e)}});return u.then(function(e){s.db=e;for(var t=0;t<o.length;t++){var n=o[t];n._dbInfo.db=e,E(n._dbInfo)}}).catch(function(t){throw(A(e,t)||i.resolve()).catch(function(){}),t})}}):c.then(function(t){S(e);var n=p[e.name],s=n.forages;t.close();for(var o=0;o<s.length;o++){var a=s[o];a._dbInfo.db=null}var c=new i(function(t,n){var s=r.deleteDatabase(e.name);s.onerror=s.onblocked=function(e){var t=s.result;t&&t.close(),n(e)},s.onsuccess=function(){var e=s.result;e&&e.close(),t(e)}});return c.then(function(e){n.db=e;for(var t=0;t<s.length;t++){var r=s[t];E(r._dbInfo)}}).catch(function(t){throw(A(e,t)||i.resolve()).catch(function(){}),t})})}else n=i.reject("Invalid arguments");return a(n,t),n}},R="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",w="~~local_forage_type~",L=/^~~local_forage_type~([^~]+)~/,P="__lfsc__:",x=P.length,D="arbf",U="blob",j="si08",k="ui08",Y="uic8",F="si16",H="si32",G="ur16",q="ui32",B="fl32",K="fl64",X=x+D.length,J=Object.prototype.toString;function $(e){var t,n,s,r,o,i=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);var u=new ArrayBuffer(i),l=new Uint8Array(u);for(t=0;t<a;t+=4)n=R.indexOf(e[t]),s=R.indexOf(e[t+1]),r=R.indexOf(e[t+2]),o=R.indexOf(e[t+3]),l[c++]=n<<2|s>>4,l[c++]=(15&s)<<4|r>>2,l[c++]=(3&r)<<6|63&o;return u}function V(e){var t,n=new Uint8Array(e),s="";for(t=0;t<n.length;t+=3)s+=R[n[t]>>2],s+=R[(3&n[t])<<4|n[t+1]>>4],s+=R[(15&n[t+1])<<2|n[t+2]>>6],s+=R[63&n[t+2]];return n.length%3==2?s=s.substring(0,s.length-1)+"=":n.length%3==1&&(s=s.substring(0,s.length-2)+"=="),s}var W={serialize:function(e,t){var n="";if(e&&(n=J.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===J.call(e.buffer))){var s,r=P;e instanceof ArrayBuffer?(s=e,r+=D):(s=e.buffer,"[object Int8Array]"===n?r+=j:"[object Uint8Array]"===n?r+=k:"[object Uint8ClampedArray]"===n?r+=Y:"[object Int16Array]"===n?r+=F:"[object Uint16Array]"===n?r+=G:"[object Int32Array]"===n?r+=H:"[object Uint32Array]"===n?r+=q:"[object Float32Array]"===n?r+=B:"[object Float64Array]"===n?r+=K:t(new Error("Failed to get type for BinaryArray"))),t(r+V(s))}else if("[object Blob]"===n){var o=new FileReader;o.onload=function(){var n=w+e.type+"~"+V(this.result);t(P+U+n)},o.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if(e.substring(0,x)!==P)return JSON.parse(e);var t,n=e.substring(X),s=e.substring(x,X);if(s===U&&L.test(n)){var r=n.match(L);t=r[1],n=n.substring(r[0].length)}var i=$(n);switch(s){case D:return i;case U:return o([i],{type:t});case j:return new Int8Array(i);case k:return new Uint8Array(i);case Y:return new Uint8ClampedArray(i);case F:return new Int16Array(i);case G:return new Uint16Array(i);case H:return new Int32Array(i);case q:return new Uint32Array(i);case B:return new Float32Array(i);case K:return new Float64Array(i);default:throw new Error("Unkown type: "+s)}},stringToBuffer:$,bufferToString:V};function z(e,t,n,s){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,s)}function Q(e,t,n,s,r,o){e.executeSql(n,s,r,function(e,i){i.code===i.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],function(e,a){a.rows.length?o(e,i):z(e,t,function(){e.executeSql(n,s,r,o)},o)},o):o(e,i)},o)}var Z={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var s in e)n[s]="string"!=typeof e[s]?e[s].toString():e[s];var r=new i(function(e,s){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return s(e)}n.db.transaction(function(r){z(r,n,function(){t._dbInfo=n,e()},function(e,t){s(t)})},s)});return n.serializer=W,r},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,s=new i(function(t,s){n.ready().then(function(){var r=n._dbInfo;r.db.transaction(function(n){Q(n,r,"SELECT * FROM "+r.storeName,[],function(n,s){for(var o=s.rows,i=o.length,a=0;a<i;a++){var c=o.item(a),u=c.value;if(u&&(u=r.serializer.deserialize(u)),void 0!==(u=e(u,c.key,a+1)))return void t(u)}t()},function(e,t){s(t)})})}).catch(s)});return a(s,t),s},getItem:function(e,t){var n=this;e=u(e);var s=new i(function(t,s){n.ready().then(function(){var r=n._dbInfo;r.db.transaction(function(n){Q(n,r,"SELECT * FROM "+r.storeName+" WHERE key = ? LIMIT 1",[e],function(e,n){var s=n.rows.length?n.rows.item(0).value:null;s&&(s=r.serializer.deserialize(s)),t(s)},function(e,t){s(t)})})}).catch(s)});return a(s,t),s},setItem:function(e,t,n){return function e(t,n,s,r){var o=this;t=u(t);var c=new i(function(i,a){o.ready().then(function(){void 0===n&&(n=null);var c=n,u=o._dbInfo;u.serializer.serialize(n,function(n,l){l?a(l):u.db.transaction(function(e){Q(e,u,"INSERT OR REPLACE INTO "+u.storeName+" (key, value) VALUES (?, ?)",[t,n],function(){i(c)},function(e,t){a(t)})},function(n){if(n.code===n.QUOTA_ERR){if(r>0)return void i(e.apply(o,[t,c,s,r-1]));a(n)}})})}).catch(a)});return a(c,s),c}.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=u(e);var s=new i(function(t,s){n.ready().then(function(){var r=n._dbInfo;r.db.transaction(function(n){Q(n,r,"DELETE FROM "+r.storeName+" WHERE key = ?",[e],function(){t()},function(e,t){s(t)})})}).catch(s)});return a(s,t),s},clear:function(e){var t=this,n=new i(function(e,n){t.ready().then(function(){var s=t._dbInfo;s.db.transaction(function(t){Q(t,s,"DELETE FROM "+s.storeName,[],function(){e()},function(e,t){n(t)})})}).catch(n)});return a(n,e),n},length:function(e){var t=this,n=new i(function(e,n){t.ready().then(function(){var s=t._dbInfo;s.db.transaction(function(t){Q(t,s,"SELECT COUNT(key) as c FROM "+s.storeName,[],function(t,n){var s=n.rows.item(0).c;e(s)},function(e,t){n(t)})})}).catch(n)});return a(n,e),n},key:function(e,t){var n=this,s=new i(function(t,s){n.ready().then(function(){var r=n._dbInfo;r.db.transaction(function(n){Q(n,r,"SELECT key FROM "+r.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,n){var s=n.rows.length?n.rows.item(0).key:null;t(s)},function(e,t){s(t)})})}).catch(s)});return a(s,t),s},keys:function(e){var t=this,n=new i(function(e,n){t.ready().then(function(){var s=t._dbInfo;s.db.transaction(function(t){Q(t,s,"SELECT key FROM "+s.storeName,[],function(t,n){for(var s=[],r=0;r<n.rows.length;r++)s.push(n.rows.item(r).key);e(s)},function(e,t){n(t)})})}).catch(n)});return a(n,e),n},dropInstance:function(e,t){t=l.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var s,r=this;return a(s=e.name?new i(function(t){var s;s=e.name===n.name?r._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:s,storeNames:[e.storeName]}):t(function(e){return new i(function(t,n){e.transaction(function(s){s.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(n,s){for(var r=[],o=0;o<s.rows.length;o++)r.push(s.rows.item(o).name);t({db:e,storeNames:r})},function(e,t){n(t)})},function(e){n(e)})})}(s))}).then(function(e){return new i(function(t,n){e.db.transaction(function(s){function r(e){return new i(function(t,n){s.executeSql("DROP TABLE IF EXISTS "+e,[],function(){t()},function(e,t){n(t)})})}for(var o=[],a=0,c=e.storeNames.length;a<c;a++)o.push(r(e.storeNames[a]));i.all(o).then(function(){t()}).catch(function(e){n(e)})},function(e){n(e)})})}):i.reject("Invalid arguments"),t),s}};function ee(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function te(){return!function(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(e){return!0}}()||localStorage.length>0}var ne={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=ee(e,this._defaultConfig),te()?(this._dbInfo=t,t.serializer=W,i.resolve()):i.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,s=n.ready().then(function(){for(var t=n._dbInfo,s=t.keyPrefix,r=s.length,o=localStorage.length,i=1,a=0;a<o;a++){var c=localStorage.key(a);if(0===c.indexOf(s)){var u=localStorage.getItem(c);if(u&&(u=t.serializer.deserialize(u)),void 0!==(u=e(u,c.substring(r),i++)))return u}}});return a(s,t),s},getItem:function(e,t){var n=this;e=u(e);var s=n.ready().then(function(){var t=n._dbInfo,s=localStorage.getItem(t.keyPrefix+e);return s&&(s=t.serializer.deserialize(s)),s});return a(s,t),s},setItem:function(e,t,n){var s=this;e=u(e);var r=s.ready().then(function(){void 0===t&&(t=null);var n=t;return new i(function(r,o){var i=s._dbInfo;i.serializer.serialize(t,function(t,s){if(s)o(s);else try{localStorage.setItem(i.keyPrefix+e,t),r(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||o(e),o(e)}})})});return a(r,n),r},removeItem:function(e,t){var n=this;e=u(e);var s=n.ready().then(function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)});return a(s,t),s},clear:function(e){var t=this,n=t.ready().then(function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var s=localStorage.key(n);0===s.indexOf(e)&&localStorage.removeItem(s)}});return a(n,e),n},length:function(e){var t=this.keys().then(function(e){return e.length});return a(t,e),t},key:function(e,t){var n=this,s=n.ready().then(function(){var t,s=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(s.keyPrefix.length)),t});return a(s,t),s},keys:function(e){var t=this,n=t.ready().then(function(){for(var e=t._dbInfo,n=localStorage.length,s=[],r=0;r<n;r++){var o=localStorage.key(r);0===o.indexOf(e.keyPrefix)&&s.push(o.substring(e.keyPrefix.length))}return s});return a(n,e),n},dropInstance:function(e,t){if(t=l.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var s,r=this;return a(s=e.name?new i(function(t){e.storeName?t(ee(e,r._defaultConfig)):t(e.name+"/")}).then(function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}}):i.reject("Invalid arguments"),t),s}},se=function(e,t){for(var n=e.length,s=0;s<n;){if((r=e[s])===(o=t)||"number"==typeof r&&"number"==typeof o&&isNaN(r)&&isNaN(o))return!0;s++}var r,o;return!1},re=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},oe={},ie={},ae={INDEXEDDB:M,WEBSQL:Z,LOCALSTORAGE:ne},ce=[ae.INDEXEDDB._driver,ae.WEBSQL._driver,ae.LOCALSTORAGE._driver],ue=["dropInstance"],le=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ue),he={description:"",driver:ce.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function de(e,t){e[t]=function(){var n=arguments;return e.ready().then(function(){return e[t].apply(e,n)})}}function pe(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(re(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var fe=function(){function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ae)if(ae.hasOwnProperty(n)){var s=ae[n],r=s._driver;this[n]=r,oe[r]||this.defineDriver(s)}this._defaultConfig=pe({},he),this._config=pe({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":s(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var s=new i(function(t,n){try{var s=e._driver,r=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(r);for(var o=le.concat("_initStorage"),c=0,u=o.length;c<u;c++){var l=o[c],h=!se(ue,l);if((h||e[l])&&"function"!=typeof e[l])return void n(r)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=i.reject(t);return a(n,arguments[arguments.length-1]),n}},n=0,s=ue.length;n<s;n++){var r=ue[n];e[r]||(e[r]=t(r))}}();var d=function(n){oe[s]&&console.info("Redefining LocalForage driver: "+s),oe[s]=e,ie[s]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(d,n):d(!!e._support):d(!0)}catch(e){n(e)}});return c(s,t,n),s},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var s=oe[e]?i.resolve(oe[e]):i.reject(new Error("Driver not found."));return c(s,t,n),s},e.prototype.getSerializer=function(e){var t=i.resolve(W);return c(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return c(n,e,e),n},e.prototype.setDriver=function(e,t,n){var s=this;re(e)||(e=[e]);var r=this._getSupportedDrivers(e);function o(){s._config.driver=s.driver()}function a(e){return s._extend(e),o(),s._ready=s._initStorage(s._config),s._ready}var u=null!==this._driverSet?this._driverSet.catch(function(){return i.resolve()}):i.resolve();return this._driverSet=u.then(function(){var e=r[0];return s._dbInfo=null,s._ready=null,s.getDriver(e).then(function(e){s._driver=e._driver,o(),s._wrapLibraryMethodsWithReady(),s._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var r=e[t];return t++,s._dbInfo=null,s._ready=null,s.getDriver(r).then(a).catch(n)}o();var c=new Error("No available storage method found.");return s._driverSet=i.reject(c),s._driverSet}()}}(r)})}).catch(function(){o();var e=new Error("No available storage method found.");return s._driverSet=i.reject(e),s._driverSet}),c(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!ie[e]},e.prototype._extend=function(e){pe(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,s=e.length;n<s;n++){var r=e[n];this.supports(r)&&t.push(r)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=le.length;e<t;e++)de(this,le[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),me=new fe;t.exports=me},{3:3}]},{},[4])(4)}).call(this,n(28))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(8),r=n(11),o=n(3),i=n(0),a=n(1);class c extends s.BaseMessage{static actionFromJSON(e){let t=new this(e[i.MessageConstatnts.KEYS.RECEIVER],e[i.MessageConstatnts.KEYS.TYPE],e[i.MessageConstatnts.KEYS.RECEIVER_TYPE],i.MessageCategory.ACTION),n=e[i.MessageConstatnts.KEYS.DATA];if(t.data=n,t.setAction(n[i.MessageConstatnts.KEYS.ACTION]),console.log("Action",{action:t}),n[i.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY])if(n[i.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][i.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==i.ActionConstatnts.ACTION_ENTITY_TYPE.USER){let e=new o.AppUser(n[i.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][i.ActionConstatnts.ACTION_KEYS.ENTITY]);Object.assign(e,n[i.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][i.ActionConstatnts.ACTION_KEYS.ENTITY]),t.by=e,t.setSender(e)}else{let e=new r.Group("","","");Object.assign(e,n[i.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][i.ActionConstatnts.ACTION_KEYS.ENTITY]),t.by=e}if(n[i.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR])if(n[i.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][i.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==i.ActionConstatnts.ACTION_ENTITY_TYPE.USER){let e=new o.AppUser(n[i.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][i.ActionConstatnts.ACTION_KEYS.ENTITY]);Object.assign(e,n[i.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][i.ActionConstatnts.ACTION_KEYS.ENTITY]),t.for=e}else{let e=new r.Group("","","");Object.assign(e,n[i.ActionConstatnts.ACTION_SUBJECTS.ACTION_FOR][i.ActionConstatnts.ACTION_KEYS.ENTITY]),t.for=e}if(n[i.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON])if(n[i.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][i.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==i.ActionConstatnts.ACTION_ENTITY_TYPE.USER){let e=new o.AppUser(n[i.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][i.ActionConstatnts.ACTION_KEYS.ENTITY]);Object.assign(e,n[i.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][i.ActionConstatnts.ACTION_KEYS.ENTITY]),t.on=e}else{let e=new r.Group("","","");Object.assign(e,n[i.ActionConstatnts.ACTION_SUBJECTS.ACTION_ON][i.ActionConstatnts.ACTION_KEYS.ENTITY]),t.on=e}return t.setMessage(t.getActionMessage(t)),console.log("This is action Object Return from JSON :",{action:t}),t}setRawData(e){this.rawData=e}getRawData(){return this.rawData}setMessage(e){this.message=e}getMessage(){return this.message}setAction(e){this.action=e}getAction(){return this.action}getSender(){return this.getSenderFromData()}setActionBy(e){this.by=e}getActionBy(){return this.by}setActionOn(e){this.on=e}getActionOn(){return this.on}setActionFor(e){this.for=e}getActionFor(){return this.for}getActionMessage(e){let t="";switch(console.log("Action Type it is",e.getType()),e.getType()){case i.ActionConstatnts.ACTION_KEYS.ACTION_TYPE_USER:case i.ActionConstatnts.ACTION_KEYS.ACTION_TYPE_GROUP:switch(e.getAction()){case i.ActionConstatnts.ACTION_KEYS.ACTION_CREATED:case i.ActionConstatnts.ACTION_KEYS.ACTION_UPDATED:case i.ActionConstatnts.ACTION_KEYS.ACTION_DELETED:}break;case i.ActionConstatnts.ACTION_KEYS.ACTION_TYPE_GROUP_MEMBER:switch(e.getAction()){case i.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_JOINED:{let n=e.getActionBy(),s=e.getActionFor();t=a.format(i.ActionConstatnts.ActionMessages.ACTION_GROUP_JOINED_MESSAGE,n.getName(),s.$name);break}case i.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_LEFT:{let n=e.getActionBy(),s=e.getActionFor();t=a.format(i.ActionConstatnts.ActionMessages.ACTION_GROUP_LEFT_MESSAGE,n.getName(),s.$name);break}case i.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_KICKED:{let n=e.getActionBy(),s=e.getActionFor(),r=e.getActionOn();t=a.format(i.ActionConstatnts.ActionMessages.ACTION_MEMBER_KICKED_MESSAGE,n.getName(),r,s.$name);break}case i.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_OUTCASTED:{let n=e.getActionBy(),s=e.getActionFor(),r=e.getActionOn();t=a.format(i.ActionConstatnts.ActionMessages.ACTION_MEMBER_OUTCASTED_MESSAGE,n.getName(),r,s.$name);break}case i.ActionConstatnts.ACTION_KEYS.TYPE_MEMBER_REINSTATED:{let n=e.getActionBy(),s=e.getActionFor(),r=e.getActionOn();t=a.format(i.ActionConstatnts.ActionMessages.ACTION_MEMBER_REINSTATED_MESSAGE,n.getName(),r,s.$name);break}case i.ActionConstatnts.ACTION_KEYS.ACTION_SCOPE_CHANGED:break;default:console.log("we are here")}}return t}getSenderFromData(){let e=this.data;if(e[i.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY]&&e[i.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][i.ActionConstatnts.ACTION_KEYS.ENTITY_TYPE]==i.ActionConstatnts.ACTION_ENTITY_TYPE.USER){let t=new o.AppUser(e[i.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][i.ActionConstatnts.ACTION_KEYS.ENTITY]);return Object.assign(t,e[i.ActionConstatnts.ACTION_SUBJECTS.ACTION_BY][i.ActionConstatnts.ACTION_KEYS.ENTITY]),t}}}c.ACTION_TYPE=i.ActionConstatnts.ACTION_TYPE,t.Action=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(0),o=n(16),i=n(2);class a{constructor(e){this.store=r.constants.DEFAULT_STORE,s.isFalsy(e)||(this.store=e),this.localStore=o.createInstance({name:s.format(r.LOCAL_STORE.STORE_STRING,i.CometChat.getAppId(),r.LOCAL_STORE.COMMON_STORE)}),this.localStore.setDriver([o.LOCALSTORAGE,o.INDEXEDDB,o.WEBSQL])}static getInstance(){return null==a.localStorage&&(console.log("Setting local Storage"),a.localStorage=new a),a.localStorage}set(e,t){return this.localStore.setItem(e,t)}remove(e){this.localStore.removeItem(e)}get(e){return this.localStore.getItem(e)}clear(e){}selectStore(e){this.store=e}}a.localStorage=null,t.LocalStorage=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EndpointFactory=class{constructor(){this.baseUrl="http://api.cometchat.com/",this.apiVersion="v8",this.apiBaseUrl=this.baseUrl+this.apiVersion+"/",this.uriEndpoints={authToken:{endpoint:"admin/users/{{uid}}/auth_tokens",method:"POST",data:{uid:"string|max:100"},isAdminApi:!0},login:{endpoint:"admin/users/auth",method:"POST",data:{uid:"string|max:100"},isAdminApi:!0},logout:{endpoint:"admin/users/auth/{{authToken}}",method:"DELETE",isAdminApi:!0},getMyDetails:{endpoint:"me",method:"GET"},updateMyDetails:{endpoint:"/me",method:"PUT"},users:{endpoint:"users",method:"GET"},user:{endpoint:"users/{{uid}}",method:"GET"},sendFriendRequests:{endpoint:"user/friends",method:"POST",data:{uids:"array<string|max:100>"}},getFriends:{endpoint:"user/friends",method:"GET"},unfriend:{endpoint:"user/friends/{{uid}}/{{gid}}",method:"DELETE",data:{uids:"array<string|max:100>"}},acceptFriendRequest:{endpoint:"user/friends/{{uid}}/accept",method:"PUT",data:{uids:"array<string|max:100>"}},rejectFriendRequest:{endpoint:"user/friends/{{uid}}/reject",method:"DELETE",data:{uids:"array<string|max:100>"}},createGroup:{endpoint:"groups",method:"POST",data:{guid:"required|string|max:100",name:"required|string|max:100",type:"enum|public,protected,password",password:"filled|string|max:100"}},getGroups:{endpoint:"groups",method:"GET"},getGroup:{endpoint:"groups/{{guid}}",method:"GET"},updateGroup:{endpoint:"groups/{{guid}}",method:"PUT"},deleteGroup:{endpoint:"groups/{{guid}}",method:"DELETE"},addGroupMembers:{endpoint:"groups/{{guid}}/members",method:"POST",data:{uids:"array<string|max:100>"}},getGroupMembers:{endpoint:"groups/{{guid}}/members",method:"GET"},joinGroup:{endpoint:"groups/{{guid}}/members",method:"POST"},leaveGroup:{endpoint:"groups/{{guid}}/members",method:"DELETE"},kickGroupMembers:{endpoint:"groups/{{guid}}/members/{{uid}}",method:"DELETE",data:{uids:"array<string|max:100>"}},changeScopeOfMember:{endpoint:"groups/{{guid}}/members/{{uid}}",method:"PUT",data:{uids:"array<string|max:100>"}},banGroupMember:{endpoint:"user/groups/{{guid}}/members/outcasts/{{uid}}",method:"POST",data:{uids:"array<string|max:100>"}},unbanGroupMember:{endpoint:"user/groups/{{guid}}/members/outcasts",method:"DELETE",data:{uids:"array<string|max:100>"}},getBannedGroupMembers:{endpoint:"groups/{{guid}}/outcasts",method:"GET"},promotemoteGroupMember:{endpoint:"user/groups/{{guid}}/promote",method:"PUT",data:{uids:"array<string|max:100>"}},demoteGroupMember:{endpoint:"user/groups/{{guid}}/demote",method:"DELETE",data:{uids:"array<string|max:100>"}},sendMessage:{endpoint:"messages",method:"POST",data:{sender:"array:string:max:100>",isGroupMember:"filled|boolean|bail",data:"required|json"}},getMessages:{endpoint:"messages",method:"GET"},getUserMessages:{endpoint:"users/{{uid}}/messages",method:"GET"},getMessage:{endpoint:"user/messages/{{muid}}",method:"GET"},updateMessage:{endpoint:"user/messages/{{muid}}",method:"PUT",data:{data:"required|json"}},deleteMessage:{endpoint:"user/messages/{{muid}}",method:"DELETE"},createCallSession:{endpoint:"calls",method:"POST",data:{}},updateCallSession:{endpoint:"calls/{{sessionid}}",method:"put",data:{}}}}getEndpointData(e){console.log("getEndpointData");let t=!1;return this.uriEndpoints.hasOwnProperty(e)&&((t=this.uriEndpoints[e]).endpoint=this.baseUrl+this.apiVersion+"/"+t.endpoint),t}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MessageEventListener=class{constructor(...e){this.onActionReceived=e[0].onActionRecived,this.onMessageReceived=e[0].onMessageReceived,this.onCallReceived=e[0].onCallReceived}};t.PresenceEventHandler=class{constructor(...e){this.onUserOnline=e[0].onUserOnline,this.onUserOffline=e[0].onUserOffline}};class s{constructor(e,t){this._name=e,this._callback=t}}t.Listner=s;t.MessageListner=class extends s{constructor(e,t,n,s){super(e,s),this._eventHander=t,n&&(this._cursor=n)}};t.PresenceListner=class extends s{constructor(e,t,n,s){super(e,s),this._eventHander=t,n&&(this._cursor=n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(0);t.UsersController=class{static trasformJSONUser(e){let t;try{t=new s.AppUser(e[r.UserConstants.UID]),Object.assign(t,e),e=t}catch(t){console.log({user:e,e:t})}return e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(11),r=n(0);t.GroupsController=class{static trasformJSONGroup(e){let t;try{t=new s.Group(e[r.GroupConstants.KEYS.GUID],e[r.GroupConstants.KEYS.NAME],e[r.GroupConstants.KEYS.NAME]),Object.assign(t,e),e=t}catch(t){console.log({group:e,e:t})}return e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(2),r=n(1),o=n(0),i=n(16);class a{constructor(e){this.store=o.constants.DEFAULT_STORE,r.isFalsy(e)||(this.store=e),this.userStore=i.createInstance({name:r.format(o.LOCAL_STORE.STORE_STRING,s.CometChat.getAppId(),o.LOCAL_STORE.USERS_STORE)}),this.userStore.setDriver([i.LOCALSTORAGE,i.INDEXEDDB,i.WEBSQL])}static getInstance(){return null==a.UserStore&&(a.UserStore=new a),a.UserStore}set(e,t){return this.userStore.setItem(e,t)}remove(e){this.userStore.removeItem(e)}get(e){return this.userStore.getItem(e)}clear(e){}selectStore(e){this.store=e}storeUsers(e){return e.map(e=>{this.set(e.getUid(),e)}),!0}storeUser(e){return this.set(e.getUid(),e),!0}}t.UserStore=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(25),r=n(14),o=n(15),i=n(38),a=n(11),c=n(39),u=n(3),l=n(2),h=n(20),d=n(40),p=n(17),f=n(0),m=n(12);t.init=function(e){return console.log({appId:e}),l.CometChat.getInstance(e)},t.TextMessage=r.TextMessage,t.MediaMessage=o.MediaMessage,t.Action=p.Action,t.Call=m.Call,t.Group=a.Group,t.AppUser=u.AppUser,t.UserMessagesRequest=i.MessagesRequest,t.UserMessagesRequestBuilder=i.MessagesRequestBuilder,t.GroupMessagesRequest=i.MessagesRequest,t.GroupMessagesRequestBuilder=i.MessagesRequestBuilder,t.UsersRequest=s.UsersRequest,t.UsersRequestBuilder=s.UsersRequestBuilder,t.GroupsRequest=c.GroupsRequest,t.GroupsRequestBuilder=c.GroupsRequestBuilder,t.GroupMembersRequest=d.GroupMembersRequest,t.GroupMembersRequestBuilder=d.GroupMembersRequestBuilder,t.OutcastMembersRequest=d.GroupMembersRequest,t.OutCastMembersRequestBuilder=d.GroupOutCastMembersRequestBuilder,t.MessageEventListener=h.MessageEventListener,t.PresenceEventHandler=h.PresenceEventHandler,t.MESSAGE_TYPE=f.MessageConstatnts.TYPE,t.ACTION_TYPE=f.ActionConstatnts.ACTION_TYPE,t.RECEIVER_TYPE=f.MessageConstatnts.RECEIVER_TYPE,t.MESSAGE_REQUEST=f.MessageConstatnts.PAGINATION.CURSOR_FILEDS,t.getElementById=function(){console.log(window.document.getElementById("frame"))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(4),r=n(1),o=n(18),i=n(21),a=n(5),c=n(23),u=n(6),l=n(0),h=n(2);class d{constructor(e){this.limit=d.DEFAULT_LIMIT,this.cursor=-1,this.total=-1,this.next_page=1,this.last_page=-1,this.current_page=1,this.total_pages=-1,this.pagination={total:0,count:0,per_page:0,current_page:0,total_pages:0,links:[]},this.store=o.LocalStorage.getInstance(),d.userStore=c.UserStore.getInstance(),r.isFalsy(e)||(this.limit=e.limit,console.log(e.limit),this.search_keyword=e.searchKeyWord)}fetchPrevious(){return new Promise((e,t)=>{if(0!=this.next_page)return s.makeApiCall("users",{},this.getPreData()).then(t=>{if(t.meta&&(this.total_pages=t.meta.pagination.total_pages),t.data.length>0){this.pagination=t.meta.pagination;let n=[];t.data.map((e,t)=>{n.push(i.UsersController.trasformJSONUser(e))}),d.userStore.storeUsers(n),e(n)}e([])},e=>{t(new a.CustomError(e))});t("Error: no mre users")})}fetchNext(){return new Promise((e,t)=>{s.makeApiCall("users",{},this.getNextData()).then(t=>{if(t.meta&&(this.total_pages=t.meta.pagination.total_pages),t.data.length>0){this.pagination=t.meta.pagination;let n=[],s=[];t.data.map(e=>{n.push(i.UsersController.trasformJSONUser(e)),s.push(r.format(l.XMPP.username_string,h.CometChat.getAppId(),e[l.UserConstants.UID]))}),u.XMPPConnectionHelper.getInstance().getPresenceInfo(s,t=>{n.map((e,n)=>{e.setLastActiveAt(t[n].getLastActiveAt()),e.setStatus(t[n].getStatus())}),d.userStore.storeUsers(n),e(n)})}else e([])},e=>{t(new a.CustomError(e))})})}getNextData(){let e={};if(e.per_page=this.limit,1==this.current_page)e.page=this.next_page,this.next_page++,this.current_page++;else{if(this.next_page>this.total_pages)return e.page=this.next_page,e;e.page=++this.next_page}return e}getPreData(){let e={};return e.per_page=this.limit,this.next_page>=0?(this.next_page>0&&(e.page=--this.next_page),e):(console.log({paginationData:e}),e)}}d.MAX_LIMIT=2,d.DEFAULT_LIMIT=1,t.UsersRequest=d;t.UsersRequestBuilder=class{setLimit(e){return this.limit=e,this}setSearchKeyWord(e){return this.searchKeyWord=e,this}build(){return new d(this)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(19);t.getEndPoint=function(e="",t={}){let n=new s.EndpointFactory;return new Promise((s,r)=>{let o=n.getEndpointData(e);if(o){for(let e in t)o.endpoint=o.endpoint.replace(`{{${e}}}`,t[e]);s(o)}else r({error:"Unknown endPoint name."})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(7);t.$iq=s.$iq,t.$build=s.$build,t.$msg=s.$msg,t.$pres=s.$pres,t.Strophe=s.Strophe,t.NS=s.Strophe.NS,t.Status=s.Strophe.Status,window.Strophe=t.Strophe,window.$iq=t.$iq},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(30),r=n(0);t.PresenceController=class{static transformPresence(e){return e.getAttribute("type")?new s.UserPresence(e.getAttribute(r.PresenceConstatnts.XMPP_KEYS.FROM),r.PresenceConstatnts.STATUS.OFFLINE,(new Date).getTime()):new s.UserPresence(e.getAttribute(r.PresenceConstatnts.XMPP_KEYS.FROM),r.PresenceConstatnts.STATUS.ONLINE,(new Date).getTime())}static transformPresences(e){let t=[];return e.map(e=>{t.push(new s.UserPresence(e.getAttribute(r.PresenceConstatnts.XMPP_KEYS.FROM),e.getAttribute(r.PresenceConstatnts.XMPP_KEYS.STATUS),e.getAttribute(r.PresenceConstatnts.XMPP_KEYS.LAST_ACTIVE_AT)))}),t}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(9);t.UserPresence=class{constructor(e,t,n,o){s.isFalsy(e)||(this.jid=e,this.uid=r.getUidFromJid(e),s.isFalsy(o)||(this.priority=o),s.isFalsy(t)||(this.status=t),s.isFalsy(n)||(this.lastActiveAt=n))}getUid(){return this.uid}setUid(e){this.uid=e}getJid(){return this.jid}setJid(e){this.jid=e}getPriority(){return this.priority}setPriority(e){this.priority=e}getStatus(){return this.status}setStatus(e){this.status=e}getLastActiveAt(){return this.lastActiveAt}setLastActiveAt(e){this.lastActiveAt=e}getStatusMessage(){return this.statusMessage}setStatusMessage(e){this.statusMessage=e}}},function(e,t,n){!function(e){"use strict";var t,n,s={}.hasOwnProperty,r=function(e,t){return function(){return e.apply(t,arguments)}};e.Strophe.addConnectionPlugin("muc",{_connection:null,rooms:{},roomNames:[],init:function(t){return this._connection=t,this._muc_handler=null,e.Strophe.addNamespace("MUC_OWNER",e.Strophe.NS.MUC+"#owner"),e.Strophe.addNamespace("MUC_ADMIN",e.Strophe.NS.MUC+"#admin"),e.Strophe.addNamespace("MUC_USER",e.Strophe.NS.MUC+"#user"),e.Strophe.addNamespace("MUC_ROOMCONF",e.Strophe.NS.MUC+"#roomconfig"),e.Strophe.addNamespace("MUC_REGISTER","jabber:iq:register")},join:function(t,s,r,o,i,a,c,u){var l,h,d;return h=this.test_append_nick(t,s),l=e.$pres({from:this._connection.jid,to:h}).c("x",{xmlns:e.Strophe.NS.MUC}),null!=c&&(l=l.c("history",c).up()),null!=a&&l.cnode(e.Strophe.xmlElement("password",[],a)),null!=u&&l.up().cnode(u),null==this._muc_handler&&(this._muc_handler=this._connection.addHandler((d=this,function(n){var s,r,o,i,a,c,u,l,h;if(!(s=n.getAttribute("from")))return!0;if(c=s.split("/")[0],!d.rooms[c])return!0;if(t=d.rooms[c],r={},"message"===n.nodeName)r=t._message_handlers;else if("presence"===n.nodeName&&(h=n.getElementsByTagName("x")).length>0)for(o=0,a=h.length;o<a;o++)if(u=h[o],(l=u.getAttribute("xmlns"))&&l.match(e.Strophe.NS.MUC)){r=t._presence_handlers;break}for(i in r)(0,r[i])(n,t)||delete r[i];return!0}))),this.rooms.hasOwnProperty(t)||(this.rooms[t]=new n(this,t,s,a),o&&this.rooms[t].addHandler("presence",o),r&&this.rooms[t].addHandler("message",r),i&&this.rooms[t].addHandler("roster",i),this.roomNames.push(t)),this._connection.send(l)},leave:function(t,n,s,r){var o,i,a,c;return o=this.roomNames.indexOf(t),delete this.rooms[t],o>=0&&(this.roomNames.splice(o,1),0===this.roomNames.length&&(this._connection.deleteHandler(this._muc_handler),this._muc_handler=null)),c=this.test_append_nick(t,n),a=this._connection.getUniqueId(),i=e.$pres({type:"unavailable",id:a,from:this._connection.jid,to:c}),null!=r&&i.c("status",r),null!=s&&this._connection.addHandler(s,null,"presence",null,a),this._connection.send(i),a},message:function(t,n,s,r,o,i){var a,c,u;return u=this.test_append_nick(t,n),o=o||(null!=n?"chat":"groupchat"),i=i||this._connection.getUniqueId(),(a=e.$msg({to:u,from:this._connection.jid,type:o,id:i}).c("body").t(s)).up(),null!=r&&(a.c("html",{xmlns:e.Strophe.NS.XHTML_IM}).c("body",{xmlns:e.Strophe.NS.XHTML}).h(r),0===a.node.childNodes.length?(c=a.node.parentNode,a.up().up(),a.node.removeChild(c)):a.up().up()),a.c("x",{xmlns:"jabber:x:event"}).c("composing"),this._connection.send(a),i},groupchat:function(e,t,n,s){return this.message(e,null,t,n,void 0,s)},invite:function(t,n,s){var r,o;return o=this._connection.getUniqueId(),r=e.$msg({from:this._connection.jid,to:t,id:o}).c("x",{xmlns:e.Strophe.NS.MUC_USER}).c("invite",{to:n}),null!=s&&r.c("reason",s),this._connection.send(r),o},multipleInvites:function(t,n,s){var r,o,i,a,c;for(a=this._connection.getUniqueId(),o=e.$msg({from:this._connection.jid,to:t,id:a}).c("x",{xmlns:e.Strophe.NS.MUC_USER}),r=0,i=n.length;r<i;r++)c=n[r],o.c("invite",{to:c}),null!=s&&(o.c("reason",s),o.up()),o.up();return this._connection.send(o),a},directInvite:function(t,n,s,r){var o,i,a;return a=this._connection.getUniqueId(),o={xmlns:"jabber:x:conference",jid:t},null!=s&&(o.reason=s),null!=r&&(o.password=r),i=e.$msg({from:this._connection.jid,to:n,id:a}).c("x",o),this._connection.send(i),a},queryOccupants:function(t,n,s){var r,o;return r={xmlns:e.Strophe.NS.DISCO_ITEMS},o=e.$iq({from:this._connection.jid,to:t,type:"get"}).c("query",r),this._connection.sendIQ(o,n,s)},configure:function(t,n,s){var r,o;return r=e.$iq({to:t,type:"get"}).c("query",{xmlns:e.Strophe.NS.MUC_OWNER}),o=r.tree(),this._connection.sendIQ(o,n,s)},cancelConfigure:function(t){var n,s;return n=e.$iq({to:t,type:"set"}).c("query",{xmlns:e.Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"cancel"}),s=n.tree(),this._connection.sendIQ(s)},saveConfiguration:function(t,n,s,r){var o,i,a,c,u;if(a=e.$iq({to:t,type:"set"}).c("query",{xmlns:e.Strophe.NS.MUC_OWNER}),void 0!==e.Strophe.x&&void 0!==e.Strophe.x.Form&&n instanceof e.Strophe.x.Form)n.type="submit",a.cnode(n.toXML());else for(a.c("x",{xmlns:"jabber:x:data",type:"submit"}),i=0,c=n.length;i<c;i++)o=n[i],a.cnode(o).up();return u=a.tree(),this._connection.sendIQ(u,s,r)},createInstantRoom:function(t,n,s){var r;return r=e.$iq({to:t,type:"set"}).c("query",{xmlns:e.Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"}),this._connection.sendIQ(r.tree(),n,s)},createConfiguredRoom:function(t,n,r,o){var i,a,c;for(i in(a=e.$iq({to:t,type:"set"}).c("query",{xmlns:e.Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"})).c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up(),n)s.call(n,i)&&(c=n[i],a.c("field",{var:i}).c("value").t(c).up().up());return this._connection.sendIQ(a.tree(),r,o)},setTopic:function(t,n){var s;return s=e.$msg({to:t,from:this._connection.jid,type:"groupchat"}).c("subject",{xmlns:"jabber:client"}).t(n),this._connection.send(s.tree())},_modifyPrivilege:function(t,n,s,r,o){var i;return i=e.$iq({to:t,type:"set"}).c("query",{xmlns:e.Strophe.NS.MUC_ADMIN}).cnode(n.node),null!=s&&i.c("reason",s),this._connection.sendIQ(i.tree(),r,o)},modifyRole:function(t,n,s,r,o,i){var a;return a=e.$build("item",{nick:n,role:s}),this._modifyPrivilege(t,a,r,o,i)},kick:function(e,t,n,s,r){return this.modifyRole(e,t,"none",n,s,r)},voice:function(e,t,n,s,r){return this.modifyRole(e,t,"participant",n,s,r)},mute:function(e,t,n,s,r){return this.modifyRole(e,t,"visitor",n,s,r)},op:function(e,t,n,s,r){return this.modifyRole(e,t,"moderator",n,s,r)},deop:function(e,t,n,s,r){return this.modifyRole(e,t,"participant",n,s,r)},modifyAffiliation:function(t,n,s,r,o,i){var a;return a=e.$build("item",{jid:n,affiliation:s}),this._modifyPrivilege(t,a,r,o,i)},ban:function(e,t,n,s,r){return this.modifyAffiliation(e,t,"outcast",n,s,r)},member:function(e,t,n,s,r){return this.modifyAffiliation(e,t,"member",n,s,r)},revoke:function(e,t,n,s,r){return this.modifyAffiliation(e,t,"none",n,s,r)},owner:function(e,t,n,s,r){return this.modifyAffiliation(e,t,"owner",n,s,r)},admin:function(e,t,n,s,r){return this.modifyAffiliation(e,t,"admin",n,s,r)},changeNick:function(t,n){var s,r;return r=this.test_append_nick(t,n),s=e.$pres({from:this._connection.jid,to:r,id:this._connection.getUniqueId()}),this._connection.send(s.tree())},setStatus:function(t,n,s,r){var o,i;return i=this.test_append_nick(t,n),o=e.$pres({from:this._connection.jid,to:i}),null!=s&&o.c("show",s).up(),null!=r&&o.c("status",r),this._connection.send(o.tree())},registrationRequest:function(t,n,s){var r;return r=e.$iq({to:t,from:this._connection.jid,type:"get"}).c("query",{xmlns:e.Strophe.NS.MUC_REGISTER}),this._connection.sendIQ(r,function(e){var t,s,r,o,i,a;for((s=e.getElementsByTagName("field")).length,o={required:[],optional:[]},i=0,a=s.length;i<a;i++)t=s[i],r={var:t.getAttribute("var"),label:t.getAttribute("label"),type:t.getAttribute("type")},t.getElementsByTagName("required").length>0?o.required.push(r):o.optional.push(r);return n(o)},s)},submitRegistrationForm:function(t,n,s,r){var o,i,a;for(i in(o=e.$iq({to:t,type:"set"}).c("query",{xmlns:e.Strophe.NS.MUC_REGISTER})).c("x",{xmlns:"jabber:x:data",type:"submit"}),o.c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#register").up().up(),n)a=n[i],o.c("field",{var:i}).c("value").t(a).up().up();return this._connection.sendIQ(o,s,r)},listRooms:function(t,n,s){var r;return r=e.$iq({to:t,from:this._connection.jid,type:"get"}).c("query",{xmlns:e.Strophe.NS.DISCO_ITEMS}),this._connection.sendIQ(r,n,s)},test_append_nick:function(t,n){var s,r;return r=e.Strophe.escapeNode(e.Strophe.getNodeFromJid(t)),s=e.Strophe.getDomainFromJid(t),r+"@"+s+(null!=n?"/"+n:"")}}),n=function(){function n(t,n,s,o){this.client=t,this.name=n,this.nick=s,this.password=o,this._roomRosterHandler=r(this._roomRosterHandler,this),this._addOccupant=r(this._addOccupant,this),this.roster={},this._message_handlers={},this._presence_handlers={},this._roster_handlers={},this._handler_ids=0,this.client.muc&&(this.client=this.client.muc),this.name=e.Strophe.getBareJidFromJid(this.name),this.addHandler("presence",this._roomRosterHandler)}return n.prototype.join=function(e,t,n){return this.client.join(this.name,this.nick,e,t,n,this.password)},n.prototype.leave=function(e,t){return this.client.leave(this.name,this.nick,e,t),delete this.client.rooms[this.name]},n.prototype.message=function(e,t,n,s){return this.client.message(this.name,e,t,n,s)},n.prototype.groupchat=function(e,t){return this.client.groupchat(this.name,e,t)},n.prototype.invite=function(e,t){return this.client.invite(this.name,e,t)},n.prototype.multipleInvites=function(e,t){return this.client.invite(this.name,e,t)},n.prototype.directInvite=function(e,t){return this.client.directInvite(this.name,e,t,this.password)},n.prototype.configure=function(e){return this.client.configure(this.name,e)},n.prototype.cancelConfigure=function(){return this.client.cancelConfigure(this.name)},n.prototype.saveConfiguration=function(e){return this.client.saveConfiguration(this.name,e)},n.prototype.queryOccupants=function(e,t){return this.client.queryOccupants(this.name,e,t)},n.prototype.setTopic=function(e){return this.client.setTopic(this.name,e)},n.prototype.modifyRole=function(e,t,n,s,r){return this.client.modifyRole(this.name,e,t,n,s,r)},n.prototype.kick=function(e,t,n,s){return this.client.kick(this.name,e,t,n,s)},n.prototype.voice=function(e,t,n,s){return this.client.voice(this.name,e,t,n,s)},n.prototype.mute=function(e,t,n,s){return this.client.mute(this.name,e,t,n,s)},n.prototype.op=function(e,t,n,s){return this.client.op(this.name,e,t,n,s)},n.prototype.deop=function(e,t,n,s){return this.client.deop(this.name,e,t,n,s)},n.prototype.modifyAffiliation=function(e,t,n,s,r){return this.client.modifyAffiliation(this.name,e,t,n,s,r)},n.prototype.ban=function(e,t,n,s){return this.client.ban(this.name,e,t,n,s)},n.prototype.member=function(e,t,n,s){return this.client.member(this.name,e,t,n,s)},n.prototype.revoke=function(e,t,n,s){return this.client.revoke(this.name,e,t,n,s)},n.prototype.owner=function(e,t,n,s){return this.client.owner(this.name,e,t,n,s)},n.prototype.admin=function(e,t,n,s){return this.client.admin(this.name,e,t,n,s)},n.prototype.changeNick=function(e){return this.nick=e,this.client.changeNick(this.name,nick)},n.prototype.setStatus=function(e,t){return this.client.setStatus(this.name,this.nick,e,t)},n.prototype.addHandler=function(e,t){var n;switch(n=this._handler_ids++,e){case"presence":this._presence_handlers[n]=t;break;case"message":this._message_handlers[n]=t;break;case"roster":this._roster_handlers[n]=t;break;default:return this._handler_ids--,null}return n},n.prototype.removeHandler=function(e){return delete this._presence_handlers[e],delete this._message_handlers[e],delete this._roster_handlers[e]},n.prototype._addOccupant=function(e){var n;return n=new t(e,this),this.roster[n.nick]=n,n},n.prototype._roomRosterHandler=function(e){var t,s,r,o,i;switch(t=n._parsePresence(e),o=t.nick,r=t.newnick||null,t.type){case"error":return!0;case"unavailable":r&&(t.nick=r,this.roster[o]&&this.roster[r]&&(this.roster[o].update(this.roster[r]),this.roster[r]=this.roster[o]),this.roster[o]&&!this.roster[r]&&(this.roster[r]=this.roster[o].update(t))),delete this.roster[o];break;default:this.roster[o]?this.roster[o].update(t):this._addOccupant(t)}for(s in i=this._roster_handlers)(0,i[s])(this.roster,this)||delete this._roster_handlers[s];return!0},n._parsePresence=function(t){var n,s,r,o,i,a,c,u,l,h;for((r={}).nick=e.Strophe.getResourceFromJid(t.getAttribute("from")),r.type=t.getAttribute("type"),r.states=[],u=t.childNodes,o=0,a=u.length;o<a;o++)switch((n=u[o]).nodeName){case"error":r.errorcode=n.getAttribute("code"),r.error=null!=(l=n.childNodes[0])?l.nodeName:void 0;break;case"status":r.status=n.textContent||null;break;case"show":r.show=n.textContent||null;break;case"x":if(n.getAttribute("xmlns")===e.Strophe.NS.MUC_USER)for(h=n.childNodes,i=0,c=h.length;i<c;i++)switch((s=h[i]).nodeName){case"item":r.affiliation=s.getAttribute("affiliation"),r.role=s.getAttribute("role"),r.jid=s.getAttribute("jid"),r.newnick=s.getAttribute("nick");break;case"status":s.getAttribute("code")&&r.states.push(s.getAttribute("code"))}}return r},n}(),function(){function e(e){this.parse=r(this.parse,this),null!=e&&this.parse(e)}e.prototype.parse=function(e){var t,n,s,r,o,i,a,c,u,l,h,d,p;for(d=e.getElementsByTagName("query")[0].childNodes,this.identities=[],this.features=[],this.x=[],o=0,u=d.length;o<u;o++)switch(s=d[o],n=s.attributes,s.nodeName){case"identity":for(i={},a=0,l=n.length;a<l;a++)t=n[a],i[t.name]=t.textContent;this.identities.push(i);break;case"feature":this.features.push(s.getAttribute("var"));break;case"x":if("FORM_TYPE"===!s.childNodes[0].getAttribute("var")||"hidden"===!s.childNodes[0].getAttribute("type"))break;for(p=s.childNodes,c=0,h=p.length;c<h;c++)(r=p[c]).attributes.type||this.x.push({var:r.getAttribute("var"),label:r.getAttribute("label")||"",value:r.firstChild.textContent||""})}return{identities:this.identities,features:this.features,x:this.x}}}(),t=function(){function e(e,t){this.room=t,this.update=r(this.update,this),this.admin=r(this.admin,this),this.owner=r(this.owner,this),this.revoke=r(this.revoke,this),this.member=r(this.member,this),this.ban=r(this.ban,this),this.modifyAffiliation=r(this.modifyAffiliation,this),this.deop=r(this.deop,this),this.op=r(this.op,this),this.mute=r(this.mute,this),this.voice=r(this.voice,this),this.kick=r(this.kick,this),this.modifyRole=r(this.modifyRole,this),this.update(e)}return e.prototype.modifyRole=function(e,t,n,s){return this.room.modifyRole(this.nick,e,t,n,s)},e.prototype.kick=function(e,t,n){return this.room.kick(this.nick,e,t,n)},e.prototype.voice=function(e,t,n){return this.room.voice(this.nick,e,t,n)},e.prototype.mute=function(e,t,n){return this.room.mute(this.nick,e,t,n)},e.prototype.op=function(e,t,n){return this.room.op(this.nick,e,t,n)},e.prototype.deop=function(e,t,n){return this.room.deop(this.nick,e,t,n)},e.prototype.modifyAffiliation=function(e,t,n,s){return this.room.modifyAffiliation(this.jid,e,t,n,s)},e.prototype.ban=function(e,t,n){return this.room.ban(this.jid,e,t,n)},e.prototype.member=function(e,t,n){return this.room.member(this.jid,e,t,n)},e.prototype.revoke=function(e,t,n){return this.room.revoke(this.jid,e,t,n)},e.prototype.owner=function(e,t,n){return this.room.owner(this.jid,e,t,n)},e.prototype.admin=function(e,t,n){return this.room.admin(this.jid,e,t,n)},e.prototype.update=function(e){return this.nick=e.nick||null,this.affiliation=e.affiliation||null,this.role=e.role||null,this.jid=e.jid||null,this.status=e.status||null,this.show=e.show||null,this},e}()}(n(7))},function(e,t,n){var s,r;s=[n(7)],void 0===(r=function(e){return function(e,t,n,s,r){var o=function(t,s,r){var o=n(s?{type:t,to:s}:{type:t});return o.c("vCard",{xmlns:e.NS.VCARD}),r&&o.cnode(r),o};e.addConnectionPlugin("vcard",{_connection:null,init:function(t){return this._connection=t,e.addNamespace("VCARD","vcard-temp")},get:function(e,t,n){var s=o("get",t);return this._connection.sendIQ(s,e,n)},set:function(e,t,n,s){var r=o("set",n,t);return this._connection.sendIQ(r,e,s)}})}(e.Strophe,e.$build,e.$iq,e.$msg,e.$pres),e}.apply(t,s))||(e.exports=r)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(0),o=n(9);t.VCardController=class{static transformVCard(e){let t={};return t[r.UserConstants.NAME]=unescape(o.parseHTML(e.getElementsByTagName(r.UserConstants.NAME)[0])),t[r.UserConstants.UID]=unescape(o.parseHTML(e.getElementsByTagName(r.UserConstants.UID)[0])),t[r.UserConstants.AVATAR]=unescape(o.parseHTML(e.getElementsByTagName(r.UserConstants.AVATAR)[0])),t[r.UserConstants.LINK]=unescape(o.parseHTML(e.getElementsByTagName(r.UserConstants.LINK)[0])),t[r.UserConstants.STATUS]=unescape(o.parseHTML(e.getElementsByTagName(r.UserConstants.STATUS)[0])),t[r.UserConstants.LAST_ACTIVE_AT]=unescape(o.parseHTML(e.getElementsByTagName(r.UserConstants.LAST_ACTIVE_AT)[0])),t[r.UserConstants.ROLE]=unescape(o.parseHTML(e.getElementsByTagName(r.UserConstants.ROLE)[0])),t[r.UserConstants.USER_NAME]=unescape(o.parseHTML(e.getElementsByTagName(r.UserConstants.USER_NAME)[0])),new s.AppUser(t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),r=n(6),o=n(1),i=n(2);class a{constructor(e,t,n){this.XMPP_HOST="i.chatforyoursite.com",this.CALL_NO_ANSWER_INTERVAL=3e4,this.XMPP_MUC_HOST="%s.i.chatforyoursite.com",this.isCallSessionActive=!1,this.call=e,this.identity=t,this.service=n}static getInstance(e,t,n){return null!=this.callController&&null!=this.callController||(this.callController=new a(e,t,n)),this.callController}initiateCall(){this.startCallSession(),this.addPresenceListner()}getActiveCall(){return this.call}joinCallMuc(e){r.XMPPConnectionHelper.getInstance().connection.muc.join(o.format(s.XMPP.muc_jid_string,i.CometChat.getAppId(),e,i.CometChat.getAppId(),"call."+s.XMPP.host),r.XMPPConnectionHelper.getInstance().connection.jid)}leaveCallMuc(e){r.XMPPConnectionHelper.getInstance().connection.muc.leave(o.format(s.XMPP.muc_jid_string,i.CometChat.getAppId(),e,i.CometChat.getAppId(),"call."+s.XMPP.host),r.XMPPConnectionHelper.getInstance().connection.jid)}startCallSession(){this.joinCallMuc(this.identity)}endCallSession(){this.leaveCallMuc(this.identity),this.isCallSessionActive=!1,a.callController=null}startCall(e,t){let n=document.createElement("iframe");n.src="https://i.chatforyoursite.com/jitsi-meet/"+e,n.name="frame",n.setAttribute("allow","camera,microphone"),n.setAttribute("width","800"),n.setAttribute("height","800"),document.body.appendChild(n),window.addEventListener("message",e=>{"hangup"==e.data.type&&document.body.removeChild(n)})}addPresenceListner(){r.XMPPConnectionHelper.getInstance().connection.addHandler(e=>(e.getElementsByTagName("x").length>0||console.log("Presence manager Main=>",{presence:e}),!0),null,"presence")}}t.CallController=a},function(e,t,n){"use strict";const s=n(36),r=n(37);function o(e,t){return t.encode?t.strict?s(e):encodeURIComponent(e):e}function i(e,t){return t.decode?r(e):e}function a(e){const t=e.indexOf("?");return-1===t?"":e.slice(t+1)}function c(e,t){const n=function(e){let t;switch(e.arrayFormat){case"index":return(e,n,s)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===s[e]&&(s[e]={}),s[e][t[1]]=n):s[e]=n};case"bracket":return(e,n,s)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==s[e]?s[e]=[].concat(s[e],n):s[e]=[n]:s[e]=n};default:return(e,t,n)=>{void 0!==n[e]?n[e]=[].concat(n[e],t):n[e]=t}}}(t=Object.assign({decode:!0,arrayFormat:"none"},t)),s=Object.create(null);if("string"!=typeof e)return s;if(!(e=e.trim().replace(/^[?#&]/,"")))return s;for(const r of e.split("&")){let[e,o]=r.replace(/\+/g," ").split("=");o=void 0===o?null:i(o,t),n(i(e,t),o,s)}return Object.keys(s).sort().reduce((e,t)=>{const n=s[t];return Boolean(n)&&"object"==typeof n&&!Array.isArray(n)?e[t]=function e(t){return Array.isArray(t)?t.sort():"object"==typeof t?e(Object.keys(t)).sort((e,t)=>Number(e)-Number(t)).map(e=>t[e]):t}(n):e[t]=n,e},Object.create(null))}t.extract=a,t.parse=c,t.stringify=((e,t)=>{if(!e)return"";const n=function(e){switch(e.arrayFormat){case"index":return(t,n,s)=>null===n?[o(t,e),"[",s,"]"].join(""):[o(t,e),"[",o(s,e),"]=",o(n,e)].join("");case"bracket":return(t,n)=>null===n?[o(t,e),"[]"].join(""):[o(t,e),"[]=",o(n,e)].join("");default:return(t,n)=>null===n?o(t,e):[o(t,e),"=",o(n,e)].join("")}}(t=Object.assign({encode:!0,strict:!0,arrayFormat:"none"},t)),s=Object.keys(e);return!1!==t.sort&&s.sort(t.sort),s.map(s=>{const r=e[s];if(void 0===r)return"";if(null===r)return o(s,t);if(Array.isArray(r)){const e=[];for(const t of r.slice())void 0!==t&&e.push(n(s,t,e.length));return e.join("&")}return o(s,t)+"="+o(r,t)}).filter(e=>e.length>0).join("&")}),t.parseUrl=((e,t)=>{const n=e.indexOf("#");return-1!==n&&(e=e.slice(0,n)),{url:e.split("?")[0]||"",query:c(a(e),t)}})},function(e,t,n){"use strict";e.exports=(e=>encodeURIComponent(e).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`))},function(e,t,n){"use strict";var s=new RegExp("%[a-f0-9]{2}","gi"),r=new RegExp("(%[a-f0-9]{2})+","gi");function o(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var n=e.slice(0,t),s=e.slice(t);return Array.prototype.concat.call([],o(n),o(s))}function i(e){try{return decodeURIComponent(e)}catch(r){for(var t=e.match(s),n=1;n<t.length;n++)t=(e=o(t,n).join("")).match(s);return e}}e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"","%FF%FE":""},n=r.exec(e);n;){try{t[n[0]]=decodeURIComponent(n[0])}catch(e){var s=i(n[0]);s!==n[0]&&(t[n[0]]=s)}n=r.exec(e)}t["%C2"]="";for(var o=Object.keys(t),a=0;a<o.length;a++){var c=o[a];e=e.replace(new RegExp(c,"g"),t[c])}return e}(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(4),r=n(13),o=n(1),i=n(10),a=n(0);class c{constructor(e){this.limit=c.DEFAULT_LIMIT,this.cursorValue=0,this.cursorAffix=a.MessageConstatnts.PAGINATION.CURSOR_AFFIX_DEFAULT,this.cursorField=a.MessageConstatnts.PAGINATION.CURSOR_FIELD_DEFAULT,this.messageStore=i.MessagesStore.getInstance(),o.isFalsy(e)||(this.limit=e.limit,this.fromUID=e.fromUID,this.cursorField=e.cursorField,this.cursorValue=e.cursorValue)}fetchPrevious(){return new Promise((e,t)=>{this.messageStore.get(this.fromUID).then(n=>{console.log({messageObject:n});let o=[];n&&(o=Object.keys(n).filter(e=>{if(parseInt(n[e][this.cursorField])<this.cursorValue)return e}));let i=0,a=[];if(o.reverse().map(e=>{i++,console.log({i:i},this.cursorValue+":"+n[e][this.cursorField]),parseInt(this.cursorValue.toString())>=parseInt(n[e][this.cursorField])&&i<=this.limit&&(this.cursorValue=n[e][this.cursorField],a=[...a,r.MessageController.trasformJSONMessge(n[e])])}).length<=this.limit){let n=[];return s.makeApiCall("getUserMessages",{uid:this.fromUID},this.createData()).then(t=>{t.data.length>0?(t.data.map(e=>{this.updateCursor(e[this.cursorField]),n.push(r.MessageController.trasformJSONMessge(e))}),this.messageStore.storeMessages(n),e([...a,...n])):a.length>0?e([...a]):e([])},e=>{t(e)})}e(a)})})}createData(){let e={};return e[a.MessageConstatnts.PAGINATION.KEYS.PER_PAGE]=this.limit,e[a.MessageConstatnts.PAGINATION.KEYS.CURSOR_AFFIX]=this.cursorAffix,e[a.MessageConstatnts.PAGINATION.KEYS.CURSOR_FIELD]=this.cursorField,e[a.MessageConstatnts.PAGINATION.KEYS.CURSOR_VALUE]=this.cursorValue,e}updateCursor(e){(this.cursorValue>e||0==this.cursorValue)&&(this.cursorValue=e)}}c.MAX_LIMIT=1,c.DEFAULT_LIMIT=1,t.MessagesRequest=c;t.MessagesRequestBuilder=class{constructor(e,t,n){this.cursorField=n,this.cursorValue=t,this.fromUID=e}setLimit(e){return this.limit=e,this}setSearchKeyWord(e){return this.searchKeyWord=e,this}build(){return new c(this)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(4),r=n(1),o=n(5),i=n(22);class a{constructor(e){this.limit=a.DEFAULT_LIMIT,this.cursor=-1,this.total=-1,this.next_page=1,this.last_page=-1,this.current_page=1,this.total_pages=-1,this.pagination={total:0,count:0,per_page:0,current_page:0,total_pages:0,links:[]},r.isFalsy(e)||(this.limit=e.limit,this.search_keyword=e.searchKeyWord)}fetchPrevious(){return new Promise((e,t)=>{if(0!=this.next_page)return s.makeApiCall("groups",{},this.getPreData()).then(n=>{if(n.meta&&(this.total_pages=n.meta.pagination.total_pages),n.data.length>0){this.pagination=n.meta.pagination;let t=[];n.data.map((e,n)=>{t.push(i.GroupsController.trasformJSONGroup(e))}),e(t)}t(new o.CustomError({}))});t("Error: no more Groups")})}fetchNext(){return new Promise((e,t)=>{s.makeApiCall("getGroups",{},this.getNextData()).then(t=>{if(t.meta&&(this.total_pages=t.meta.pagination.total_pages),t.data.length>0){this.pagination=t.meta.pagination;let n=[];t.data.map((e,t)=>{n.push(i.GroupsController.trasformJSONGroup(e))}),e(n)}e([])},e=>{t(new o.CustomError(e))})})}getNextData(){let e={};if(e.per_page=this.limit,1==this.current_page)e.page=this.next_page,this.next_page++,this.current_page++;else{if(this.next_page>this.total_pages)return e.page=this.next_page,e;e.page=++this.next_page}return e}getPreData(){let e={};return e.per_page=this.limit,this.next_page>=0?(this.next_page>0&&(e.page=--this.next_page),e):e}}a.MAX_LIMIT=2,a.DEFAULT_LIMIT=1,t.GroupsRequest=a;t.GroupsRequestBuilder=class{setLimit(e){return this.limit=e,this}setSearchKeyWord(e){return this.searchKeyWord=e,this}build(){return new a(this)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(4),r=n(1),o=n(18),i=n(5),a=n(41);class c{constructor(e){this.limit=c.DEFAULT_LIMIT,this.cursor=-1,this.total=-1,this.next_page=1,this.last_page=-1,this.current_page=1,this.total_pages=-1,this.isOutCastReq=!1,this.pagination={total:0,count:0,per_page:0,current_page:0,total_pages:0,links:[]},this.store=o.LocalStorage.getInstance(),r.isFalsy(e)||(this.limit=e.limit,this.guid=e.guid,this.search_keyword=e.searchKeyWord,e instanceof l&&(this.isOutCastReq=e.isOutCastReq))}fetchPrevious(){return new Promise((e,t)=>{if(0!=this.next_page)return s.makeApiCall(this.isOutCastReq?"getBannedGroupMembers":"getGroupMembers",{guid:this.guid},this.getPreData()).then(t=>{if(t.meta&&(this.total_pages=t.meta.pagination.total_pages),t.data.length>0){this.pagination=t.meta.pagination;let n=[];t.data.map(e=>{n.push(a.GroupMembersController.trasformJSONGroupMember(e))}),e(n)}e([])},e=>{t(new i.CustomError(e))});t("Error: no mre users")})}fetchNext(){return new Promise((e,t)=>{console.log(),s.makeApiCall(this.isOutCastReq?"getBannedGroupMembers":"getGroupMembers",{guid:this.guid},this.getNextData()).then(t=>{if(t.meta&&(this.total_pages=t.meta.pagination.total_pages),t.data.length>0){this.pagination=t.meta.pagination;let n=[];t.data.map(e=>{n.push(a.GroupMembersController.trasformJSONGroupMember(e))}),e(n)}e([])},e=>{t(new i.CustomError(e))})})}getNextData(){let e={};if(e.per_page=this.limit,1==this.current_page)e.page=this.next_page,this.next_page++,this.current_page++;else{if(this.next_page>this.total_pages)return e.page=this.next_page,console.log({paginationData:e}),e;e.page=++this.next_page}return e}getPreData(){let e={};return e.per_page=this.limit,this.next_page>=0?(this.next_page>0&&(e.page=--this.next_page),e):(console.log({paginationData:e}),e)}}c.MAX_LIMIT=2,c.DEFAULT_LIMIT=1,t.GroupMembersRequest=c;class u{constructor(e){this.guid=e}setLimit(e){return this.limit=e,this}setSearchKeyWord(e){return this.searchKeyWord=e,this}build(){return new c(this)}}t.GroupMembersRequestBuilder=u;class l extends u{constructor(e){super(e),this.isOutCastReq=!0}build(){return new c(this)}}t.GroupOutCastMembersRequestBuilder=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(42),r=n(3),o=n(0);t.GroupMembersController=class{static trasformJSONGroupMember(e){let t,n;try{t=new s.GroupMember(e[o.GroupMemersConstans.GUID],e[o.GroupMemersConstans.UID]),n=new r.AppUser({uid:e[o.GroupMemersConstans.UID]}),Object.assign(t,e),Object.assign(n,e[o.GroupMemersConstans.USER]),t.setUser(n),e=t}catch(t){console.log({groupMember:e,e:t})}return e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);t.GroupMember=class{constructor(e,t){this.GroupMemberScope=s.GroupMemberScope,this.isBanned=0,this.guid=e,this.uid=t}setGuid(e){this.guid=e}setUid(e){this.uid=e}setScope(e){this.scope=e}setJoinedAt(e){this.joinedAt=e}setIsBanned(e){this.isBanned=e}setUser(e){this.user=e}getGuid(){return this.guid}getUid(){return this.uid}getuser(){return this.user}getScope(){return this.scope}getJoinedAt(){return this.joinedAt}getIsBanned(){return this.isBanned}get $guid(){return this.guid}get $user(){return this.user}get $scope(){return this.scope}get $joinedAt(){return this.joinedAt}set $guid(e){this.guid=e}set $user(e){this.user=e}set $scope(e){this.scope=e}set $joinedAt(e){this.joinedAt=e}}}]).CometChat;